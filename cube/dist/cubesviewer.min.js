/*! cubesviewer 14-06-2016 */
"use strict";function CubesViewer(){this.version="2.0.3-devel",this.VIEW_STATE_INITIALIZING=1,this.VIEW_STATE_INITIALIZED=2,this.VIEW_STATE_ERROR=3,this._configure=function(a){$(".cv-version").html(cubesviewer.version),angular.module("cv").constant("cvOptions",a)},this.init=function(a){this._configure(a),angular.element(document).ready(function(){angular.bootstrap(document,["cv"])})},this.createView=function(a,b,c){var d=angular.element(document).injector().get("$compile"),e=angular.element(document).injector().get("viewsService"),f=e.createView("cube",c),g='<div class="cv-bootstrap"><div cv-view-cube view="view"></div></div>';$(a).first().html(g);var h=angular.element(document).scope().$root,i=h.$new();return i.view=f,d($(a).first().contents())(i),f},this.apply=function(a){angular.element(document).scope()?angular.element(document).scope().$apply(a):(console.debug("Delaying"),setTimeout(function(){cubesviewer.apply(a)},1e3))}}function cubesviewerViewCubeExplore(){this._drilldownSortFunction=function(a,b){var c=a.params.drilldown.slice(0);return b&&c.splice(0,0,a.params.xaxis),function(b,d){for(var e=0;e<c.length;e++){var f=a.cube.cvdim_dim(c[e]);if(1==f.is_flat){if(b[f.name]<d[f.name])return-1;if(b[f.name]>d[f.name])return 1}else for(var g=0;g<f.levels.length;g++){var h=f.name+"."+f.levels[g].name;if(!(h in b&&h in d))break;if(b[h]<d[h])return-1;if(b[h]>d[h])return 1}}return 0}},this.columnTooltipAttr=function(a){return function(b,c,d){return'title="'+a+" = "+c+'"'}}}function cubesviewerViewCubeDynamicChart(){this.onViewDraw=function(a,b){$(".cv-view-series-horizontal-menu",$(b.container)).remove(),$(".cv-view-series-horizontal-info",$(b.container)).parents(".infopiece").remove()},this.loadData=function(a){var b=this.cubesviewer.views.cube.buildQueryParams(a,!1,!1);$("#"+a.id).find(".cv-view-viewdata").empty().append('<h3>Dynamic Chart</h3><span class="ajaxloader" title="Loading...">  Loading</span>'),$.get(a.cubesviewer.options.cubesUrl+"/cube/"+a.cube.name+"/aggregate",b,a.cubesviewer.views.cube.dynamicchart._loadDataCallback(a),"json")}}function CubesViewerStudio(){this._configure=function(a){cubesviewer._configure(a)},this.init=function(a){this._configure(a),angular.element(document).ready(function(){angular.bootstrap(document,["cv.studio"])})}}angular.module("bootstrapSubmenu",[]).directive("submenu",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){$(c).submenupicker()},500)}}}]),function(){var a={};a.map=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d]));return c},a.filter=function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},a.find=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return a[c]}else for(c in a)if(b(a[c]))return a[c];return null},a.indexOf=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return c}else for(c in a)if(b(a[c]))return c;return-1},a.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},a.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)};var b=this,c={};c.Server=function(a){a?this.ajaxRequest=a:this.ajaxRequest=$.ajax,this._cube_list=[],this._cubes={}},c.Server.prototype.cubeinfo=function(a){var b=$.grep(this._cube_list,function(b){return b.name==a});if(1!=b.length)throw"Found "+b.length+" cubes with name '"+a+"' in the cube list";return b[0]},c.Server.prototype.ajaxRequest=function(a){throw"Must implement ajaxRequest for server to process jquery-style $.ajax settings object"},c.Server.prototype.query=function(a,b,c,d,e,f){var g={dataType:"json",type:"GET"},h=null;return h=b.hasOwnProperty("name")?b.name:b,g.url=this.url+"cube/"+h+"/"+a,g.data=c,c&&c.cut&&(g.data.cut=g.data.cut.toString()),c&&c.drilldown&&(g.data.drilldown=g.data.drilldown.toString()),g.success=function(a){d(a)},g.error=function(a){e&&e(a)},g.complete=function(a){f&&f(a)},this.ajaxRequest(g)},c.Server.prototype.connect=function(a,b,c){var d=this;d.url=d._normalize_url(a);var e={dataType:"json",type:"GET"};e.url=d.url+"info",e.success=function(a,e,f){d.server_version=a.cubes_version,d.cubes_version=a.cubes_version,d.api_version=a.api_version,d.info=a,d.load_cube_list(b,c)},e.error=function(a,b,d){c&&c(a)},this.ajaxRequest(e)},c.Server.prototype._normalize_url=function(a){return"/"!=a[a.length-1]?a+"/":a},c.Server.prototype.load_cube_list=function(a,b){var c=this,d={dataType:"json",type:"GET"};return d.url=c.url+"cubes",d.success=function(b,d,e){c._cube_list=b,a&&a(c._cube_list)},d.error=function(a,c,d){b&&b(a)},this.ajaxRequest(d)},c.Server.prototype.get_cube=function(a,b,d){var e=this;if(a in this._cubes&&b){var f=$.Deferred();return f.error=function(){},setTimeout(function(){b(e._cubes[a]),f.resolve()},0),f}var g={dataType:"json",type:"GET"};return g.url=e.url+"cube/"+encodeURI(a)+"/model",g.success=function(d,f,g){var h=new c.Cube(d);e._cubes[a]=h,b&&b(h)},g.error=function(a,b,c){d&&d(a)},this.ajaxRequest(g)},c.Cube=function(b){this.name=b.name,!b.label||(this.label=b.label),!b.description||(this.description=b.description),!b.key||(this.key=b.key),!b.info||(this.info=b.info),!b.category||(this.category=b.category),!b.features||(this.features=b.features),this.measures=a.map(b.measures||[],function(a){return new c.Measure(a)}),this.aggregates=a.map(b.aggregates||[],function(a){return new c.MeasureAggregate(a)}),this.details=a.map(b.details||[],function(a){return new c.Attribute(a)}),this.dimensions=a.map(b.dimensions||[],function(a){return new c.Dimension(a)})},c.Cube.prototype.dimension=function(b){return a.isObject(b)?b:a.find(this.dimensions,function(a){return a.name===b})},c.Dimension=function(a){var b,d=this;if(d.name=a.name,d.label=a.name,!a.label||(d.label=a.label),!a.description||(d.description=a.description),!a.default_hierarchy_name||(d.default_hierarchy_name=a.default_hierarchy_name),!a.info||(d.info=a.info),!a.role||(d.role=a.role),!a.cardinality||(d.cardinality=a.cardinality),!a.nonadditive||(d.nonadditive=a.nonadditive),d.levels=[],a.levels)for(b in a.levels){var e=new c.Level(d.name,a.levels[b]);d.levels.push(e)}if(this.hierarchies={},a.hierarchies)for(b in a.hierarchies){var f=new c.Hierarchy(a.hierarchies[b],this);d.hierarchies[f.name]=f}!d.default_hierarchy_name&&a.hierarchies&&a.hierarchies.length>0&&(d.default_hierarchy_name=a.hierarchies[0].name)},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Dimension.prototype.level=function(b){return a.isObject(b)?b:a.find(this.levels,function(a){return a.name==b})},c.Dimension.prototype.toString=function(a){return this.name},c.Dimension.prototype.display_label=function(){return this.label||this.name},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:null!=b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Hierarchy=function(a,b){this.parse(a,b)},c.Hierarchy.prototype.parse=function(b,c){var d=this;d.name=b.name,d.label=d.name,!b.label||(d.label=b.label),!b.description||(d.description=b.description),!b.info||(d.info=b.info);var e=b.levels||[];d.levels=a.map(e,function(a){return c.level(a)})},c.Hierarchy.prototype.toString=function(){return c.HIERARCHY_PREFIX_CHAR+this.name},c.Hierarchy.prototype.display_label=function(){return this.label||this.name},c.Level=function(a,b){this.parse(a,b)},c.Level.prototype.parse=function(a,b){var d,e=this;if(e.dimension_name=a,e.name=b.name,!b.label||(e.label=b.label),!b.description||(e.description=b.description),!b.info||(e.info=b.info),e._key=b.key,e._label_attribute=b.label_attribute,e._order_attribute=b.order_attribute,!b.role||(e.role=b.role),!b.cardinality||(e.cardinality=b.cardinality),e.nonadditive=b.nonadditive,e.attributes=[],b.attributes)for(d in b.attributes){var f=new c.Attribute(b.attributes[d]);e.attributes.push(f)}},c.Level.prototype.key=function(){var b=this._key,c=a.find(this.attributes,function(a){return a.name===b});return c||this.attributes[0]},c.Level.prototype.label_attribute=function(){var b=null;if(this._label_attribute){var c=this._label_attribute;b=a.find(this.attributes,function(a){return a.name===c})}return b||this.key()},c.Level.prototype.order_attribute=function(){var b=null,c=this._order_attribute;return c&&(b=a.find(this.attributes,function(a){return a.name===c})),b||this.label_attribute()},c.Level.prototype.toString=function(){return this.name},c.Level.prototype.display_name=function(){return this.label||this.name},c.Level.prototype.full_name=function(){return this.dimension_name+c.ATTRIBUTE_STRING_SEPARATOR_CHAR+this.name},c.Level.prototype.full_name_for_drilldown=function(){return this.dimension_name+c.DIMENSION_STRING_SEPARATOR_CHAR+this.name},c.Attribute=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.locales=a.locales},c.Measure=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,a.aggregates&&(this.aggregates=a.aggregates)},c.MeasureAggregate=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.locales=a.locales,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,this["function"]=a["function"],this.measure=a.measure},c.Browser=function(a,b){this.cube=b,this.server=a},c.Browser.prototype.full_cube=function(){return new c.Cell(this.cube)},c.Browser.prototype.aggregate=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.measure&&(c.measure=a.measure.toString()),a.drilldown&&(c.drilldown=a.drilldown.toString()),a.split&&(c.split=a.split.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("aggregate",this.cube,a,b)},c.Browser.prototype.facts=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("facts",this.cube,a,b)},c.Drilldown=function(b,c,d){if(!a.isObject(b))throw"Drilldown requires a Dimension object as first argument";if(this.dimension=b,this.hierarchy=b.hierarchy(c),this.level=b.level(d)||this.hierarchy.levels[0],!this.hierarchy)throw"Drilldown cannot recognize hierarchy "+c+" for dimension "+b;if(!this.level)throw"Drilldown cannot recognize level "+d+" for dimension "+b},c.Drilldown.prototype.toString=function(){return""+this.dimension+this.hierarchy+c.DIMENSION_STRING_SEPARATOR_CHAR+this.level},c.Drilldown.prototype.keysInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.key().ref})},c.Drilldown.prototype.labelsInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.label_attribute().ref})},c.Cell=function(b,c){this.cube=b,this.cuts=a.map(c||[],function(a){return a})},c.Cell.prototype.slice=function(a){for(var b=[],d=!1,e=0;e<this.cuts.length;e++){var f=this.cuts[e];f.dimension==a.dimension?(b.push(a),d=!0):b.push(f)}d||b.push(a);var g=new c.Cell(this.cube,b);return g},c.Cell.prototype.toString=function(){return a.map(this.cuts||[],function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},c.Cell.prototype.cut_for_dimension=function(b){return a.find(this.cuts,function(a){return a.dimension.name==b})},c.PointCut=function(a,b,c,d){this.type="point",this.dimension=a,this.hierarchy=a.hierarchy(b),this.path=c,this.invert=!!d},c.PointCut.prototype.toString=function(){var a=c.string_from_path(this.path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.SetCut=function(a,b,c,d){this.type="set",this.dimension=a,this.hierarchy=a.hierarchy(b),this.paths=c,this.invert=!!d},c.SetCut.prototype.toString=function(){var b=a.map(this.paths,c.string_from_path).join(c.SET_CUT_SEPARATOR_CHAR);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+b},c.RangeCut=function(a,b,c,d,e){if(this.type="range",this.dimension=a,this.hierarchy=a.hierarchy(b),null===c&&null===d)throw"Either from_path or to_path must be defined for RangeCut";this.from_path=c,this.to_path=d,this.invert=!!e},c.RangeCut.prototype.toString=function(){var a=c.string_from_path(this.from_path)+c.RANGE_CUT_SEPARATOR_CHAR+c.string_from_path(this.to_path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.CUT_INVERSION_CHAR="!",c.CUT_STRING_SEPARATOR_CHAR="|",c.DIMENSION_STRING_SEPARATOR_CHAR=":",c.ATTRIBUTE_STRING_SEPARATOR_CHAR=".",c.HIERARCHY_PREFIX_CHAR="@",c.PATH_STRING_SEPARATOR_CHAR=",",c.RANGE_CUT_SEPARATOR_CHAR="-",c.SET_CUT_SEPARATOR_CHAR=";",c.CUT_STRING_SEPARATOR=/\|/g,c.DIMENSION_STRING_SEPARATOR=/:/g,c.PATH_STRING_SEPARATOR=/,/g,c.RANGE_CUT_SEPARATOR=/-/g,c.SET_CUT_SEPARATOR=/;/g,c.PATH_PART_ESCAPE_PATTERN=/([\\!|:;,-])/g,c.PATH_PART_UNESCAPE_PATTERN=/\\([\\!|:;,-])/g,c.CUT_PARSE_REGEXP=new RegExp("^("+c.CUT_INVERSION_CHAR+"?)(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(.*)$"),c.DRILLDOWN_PARSE_REGEXP=new RegExp("^(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?(?:"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(\\w+))?$"),c.NULL_PART_STRING="__null__",c.SPLIT_DIMENSION_STRING="__within_split__",c.SPLIT_DIMENSION=new c.Dimension({name:c.SPLIT_DIMENSION_STRING,label:"Matches Filters",hierarchies:[{name:"default",levels:[c.SPLIT_DIMENSION_STRING]}],levels:[{name:c.SPLIT_DIMENSION_STRING,attributes:[{name:c.SPLIT_DIMENSION_STRING}],label:"Matches Filters"}]}),c._split_with_negative_lookbehind=function(a,b,c){for(var d,e=a,f=[];null!=(d=b.exec(e));)e.substr(d.index-c.length,c.length)!=c&&(f.push(e.substring(0,d.index)),e=e.substring(Math.min(d.index+d[0].length,e.length)),b.lastIndex=0);return f.push(e),f},c._escape_path_part=function(a){return null==a?c.NULL_PART_STRING:a.toString().replace(c.PATH_PART_ESCAPE_PATTERN,function(a,b){return"\\"+b})},c._unescape_path_part=function(a){return a===c.NULL_PART_STRING?null:a.replace(c.PATH_PART_UNESCAPE_PATTERN,function(a,b){return b})},c.string_from_path=function(b){var d=a.map(b||[],function(a){return c._escape_path_part(a)}).join(c.PATH_STRING_SEPARATOR_CHAR);return d},c.path_from_string=function(b){var d=c._split_with_negative_lookbehind(b,c.PATH_STRING_SEPARATOR,"\\"),e=a.map(d||[],function(a){return c._unescape_path_part(a)});return e},c.cut_from_string=function(b,d){var e=c.CUT_PARSE_REGEXP.exec(d);if(!e)return null;var f=!!e[1],g=e[2],h=e[3]||null,i=e[4],j=b.dimension(g),k=c._split_with_negative_lookbehind(i,c.SET_CUT_SEPARATOR,"\\");if(k.length>1)return new c.SetCut(j,h,a.map(k,function(a){return c.path_from_string(a)}),f);if(k=c._split_with_negative_lookbehind(i,c.RANGE_CUT_SEPARATOR,"\\"),2==k.length){var l=k[0]?c.path_from_string(k[0]):null,m=k[1]?c.path_from_string(k[1]):null;return new c.RangeCut(j,h,l,m,f)}return new c.PointCut(j,h,c.path_from_string(i),f)},c.cuts_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.cut_from_string(b,a)})},c.cell_from_string=function(a,b){return new c.Cell(a,c.cuts_from_string(a,b))},c.drilldown_from_string=function(a,b){var d=c.DRILLDOWN_PARSE_REGEXP.exec(b);if(!d)return null;var e=d[1],f=d[2]||null,g=d[3]||null,h=a.dimension(e);if(!h){if(e!==c.SPLIT_DIMENSION_STRING)return null;h=c.SPLIT_DIMENSION}return new c.Drilldown(h,f,g)},c.drilldowns_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.drilldown_from_string(b,a)})},c.drilldowns_to_string=function(b){return a.map(b,function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},b.cubes=c}.call(this),cubes.Dimension.prototype.hierarchies_count=function(){var a=0;for(var b in this.hierarchies)this.hierarchies.hasOwnProperty(b)&&a++;return a},cubes.Dimension.prototype.default_hierarchy=function(){return this.hierarchies[this.default_hierarchy_name]},cubes.Dimension.prototype.isDateDimension=function(){return!("time"!=this.role||"cv-datefilter"in this.info&&1!=this.info["cv-datefilter"])},cubes.Cube.prototype.dateDimensions=function(){var a=[];for(var b in this.dimensions){var c=this.dimensions[b];c.isDateDimension()&&a.push(c)}return a},cubes.Cube.prototype.cvdim_dim=function(a){var b=a;return a.indexOf("@")>0?b=a.split("@")[0]:a.indexOf(":")>0&&(b=a.split(":")[0]),this.dimension(b)},cubes.Cube.prototype.dimensionPartsFromCut=function(a){var b=this.dimensionParts(a.dimension),c=(a.value.split(";")[0].match(/,/g)||[]).length+1,d=b.dimension.name+"@"+b.hierarchy.name+":"+b.hierarchy.levels[c-1].name;return this.dimensionParts(d)},cubes.Cube.prototype.dimensionParts=function(a){if(!a)return null;var b=this.cvdim_dim(a),c=b.default_hierarchy();if(a.indexOf("@")>0){var d=a.split("@")[1].split(":")[0];c=b.hierarchy(d)}var e=null,f=0;if(a.indexOf(":")>0){var g=a.split(":")[1];for(e=b.level(g),f=0;f<c.levels.length&&c.levels[f]!=e;f++);}else e=b.level(c.levels[0]);for(var h=null,i=0;i<c.levels.length;i++)if(e.name==c.levels[i]){h=i+1;break}return{dimension:b,level:e,levelIndex:f,depth:h,hierarchy:c,label:b.label+("default"!=c.name?" - "+c.label:"")+(c.levels.length>1?" / "+e.label:""),labelShort:b.label+(c.levels.length>1?" / "+e.label:""),labelNoLevel:b.label+("default"!=c.name?" - "+c.label:""),fullDrilldownValue:b.name+("default"!=c.name?"@"+c.name:"")+":"+e.name,drilldownDimension:b.name+"@"+c.name+":"+e.name,drilldownDimensionPlus:c.levels.length>1&&f<c.levels.length-1?b.name+"@"+c.name+":"+c.levels[f+1].name:null,drilldownDimensionMinus:c.levels.length>1&&f>0?b.name+"@"+c.name+":"+c.levels[f-1].name:null,cutDimension:b.name+("default"!=c.name?"@"+c.name:"")}},cubes.Cube.prototype.measureAggregates=function(a){var b=$.grep(this.aggregates,function(b){return a?b.measure==a:!b.measure});return b},cubes.Cube.prototype.aggregateFromName=function(a){var b=$.grep(this.aggregates,function(b){return a?b.name==a:!b.measure});return 1==b.length?b[0]:null},cubes.Level.prototype.readCell=function(a){if(!(this.key().ref in a))return null;var b={};return b.key=a[this.key().ref],b.label=a[this.label_attribute().ref],b.orderValue=a[this.order_attribute().ref],b.info={},$(this.attributes).each(function(c,d){b.info[d.ref]=a[d.ref]}),b},cubes.Hierarchy.prototype.readCell=function(a,b){for(var c=[],d=0;d<this.levels.length;d++){var e=this.levels[d],f=e.readCell(a);if(null!=f&&c.push(f),void 0!=b&&null!=b&&b.name==e.name)break}return c},angular.module("cv.cubes",[]),angular.module("cv.cubes").service("cubesService",["$rootScope","$log","cvOptions","gaService",function(a,b,c,d){var e=this;this.cubesserver=null,this.state=cubesviewer.VIEW_STATE_INITIALIZING,this.stateText="",this.initialize=function(){},this.connect=function(){this.cubesserver=new cubes.Server(e._cubesAjaxHandler),console.debug("Cubes client connecting to: "+c.cubesUrl),this.cubesserver.connect(c.cubesUrl,function(){b.debug("Cubes client initialized (server version: "+e.cubesserver.server_version+")"),e.state=cubesviewer.VIEW_STATE_INITIALIZED,a.$apply()},function(b){console.debug(b),console.debug("Could not connect to Cubes server [code="+b.status+"]"),e.state=cubesviewer.VIEW_STATE_ERROR,401==b.status?e.stateText="Unauthorized.":403==b.status?e.stateText="Forbidden.":400==b.status?e.stateText="Bad request: "+$.parseJSON(b.responseText).message:e.stateText="Unknown error.",a.$apply()})},this._cubesAjaxHandler=function(a){return e.cubesRequest(a.url,a.data||[],a.success,a.error)},this.cubesRequest=function(a,f,g,h){"/"==a.charAt(0)&&(a=c.cubesUrl+a),c.debug&&b.debug("Cubes request: "+a+" ("+JSON.stringify(f)+")");var i=$.get(a,f,e._cubesRequestCallback(g),c.jsonRequestType);i.fail(h||e.defaultRequestErrorHandler);try{d.trackRequest(a)}catch(j){b.error("An error happened during CubesViewer event tracking: "+j)}return i},this._cubesRequestCallback=function(a){return function(b,c){a(b)}},this.defaultRequestErrorHandler=function(a,c,d){b.error("Cubes request error: "+a)},this.buildBrowserArgs=function(a,b,c){var d={};if(!c){var e=a.params.drilldown.slice(0);b&&e.splice(0,0,a.params.xaxis);for(var f=0;f<e.length;f++)e[f]=cubes.drilldown_from_string(a.cube,a.cube.dimensionParts(e[f]).fullDrilldownValue);e.length>0&&(d.drilldown=cubes.drilldowns_to_string(e))}var g=this.buildQueryCuts(a);return g.length>0&&(d.cut=new cubes.Cell(a.cube,g)),d},this.buildQueryCutsStrings=function(a){var b=[];return $(a.params.cuts).each(function(c,d){var e=d.invert?"!":"",f=a.cube.dimensionParts(d.dimension),g=f.dimension.name+("default"!=f.hierarchy.name?"@"+f.hierarchy.name:"");b.push(e+g+":"+d.value.replace("-","\\-"))}),$(a.params.datefilters).each(function(c,d){var f=e.datefilterValue(a,d);null!=f&&b.push(d.dimension+":"+f)}),b},this.buildQueryCuts=function(a){var b=[],c=e.buildQueryCutsStrings(a);return $(c).each(function(c,d){b.push(cubes.cut_from_string(a.cube,d))}),b},this.datefilterValue=function(a,b){var c=null,d=null;if(0==b.mode.indexOf("auto-")?"auto-last1m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-1)):"auto-last3m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-3)):"auto-last6m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-6)):"auto-last12m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-12)):"auto-last24m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-24)):"auto-january1st"==b.mode?(c=new Date,c.setMonth(0),c.setDate(1)):"auto-yesterday"==b.mode&&(c=new Date,c.setDate(c.getDate()-1),d=new Date,d.setDate(c.getDate()-1)):"custom"==b.mode&&(null!=b.date_from&&""!=b.date_from&&(c=new Date(b.date_from)),null!=b.date_to&&""!=b.date_to&&(d=new Date(b.date_to))),null!=c||null!=d){var f="";return null!=c&&(f+=e._datefiltercell(a,b,c)),f+="-",null!=d&&(f+=e._datefiltercell(a,b,d)),f}return null},this._datefiltercell=function(a,b,c){for(var d=[],e=a.cube.dimensionParts(b.dimension),f=0;f<e.hierarchy.levels.length;f++){var g=e.hierarchy.levels[f],h=g.role;"year"==h?d.push(c.getFullYear()):"month"==h?d.push(c.getMonth()+1):"quarter"==h?d.push(Math.floor(c.getMonth()/3)+1):"week"==h?d.push(this._weekNumber(c)):"day"==h?d.push(c.getDate()):dialogService.show("Wrong configuration of model: time role of level '"+g.name+"' is invalid.")}return d.join(",")},this._weekNumber=function(a){a=new Date(a),a.setHours(0,0,0);var b=new Date(a.getFullYear(),0,1),c=Math.ceil(((a-b)/864e5+1)/7);return c},this.initialize()}]),angular.module("cv.cubes").service("cubesCacheService",["$rootScope","$log","cvOptions","cubesService","gaService",function(a,b,c,d,e){var f=this;this.cache={},this._cacheOverridedCubesRequest=null,this.initialize=function(){return this._cacheOverridedCubesRequest?void b.warn("Error: tried to initialize CubesCacheService but it was already initialized."):void(c.cacheEnabled&&(b.debug("Replacing Cubes request method with caching version."),f._cacheOverridedCubesRequest=d.cubesRequest,d.cubesRequest=f.cachedCubesRequest))},this.cachedCubesRequest=function(a,d,g,h){f._cacheCleanup();var i=a+"?"+$.param(d),j=null;if(i in f.cache&&c.cacheEnabled){var k=Math.round(((new Date).getTime()-f.cache[i].time)/1e3);k>c.cacheNotice&&b.debug("Data loaded from cache ("+Math.floor(k/60,2)+" minutes old)"),j=$.Deferred(),j.error=function(){},setTimeout(function(){g(f.cache[i].data),j.resolve()},0),e.trackRequest(a)}else j=f._cacheOverridedCubesRequest(a,d,f._cacheCubesRequestSuccess(g,i),h);return j},this._cacheCleanup=function(){var a=c.cacheDuration,b=c.cacheSize,d=(new Date).getTime()-1e3*a,e=[];for(var g in f.cache)f.cache[g].time<d?delete f.cache[g]:e.push(g);if(e.sort(function(a,b){return f.cache[a].time-f.cache[b].time}),e.length>=b)for(var h=0;h<e.length-b;h++)delete f.cache[e[h]]},this._cacheCubesRequestSuccess=function(a,b){return function(c){f.cache[b]={time:(new Date).getTime(),data:c},a(c)}}}]),angular.module("cv",["ui.bootstrap","bootstrapSubmenu","ui.grid","ui.grid.resizeColumns","ui.grid.selection","ui.grid.autoResize","ui.grid.pagination","ui.grid.pinning","ngCookies","cv.cubes","cv.views"]),angular.module("cv").config(["$logProvider","cvOptions",function(a,b){var c={cubesUrl:null,jsonRequestType:"json",pagingOptions:[15,30,100,250],cacheEnabled:!0,cacheDuration:1800,cacheNotice:600,cacheSize:32,datepickerShowWeeks:!0,datepickerFirstDay:1,undoEnabled:!0,undoSize:32,seriesOperationsEnabled:!1,hideControls:!1,gaTrackEvents:!1,debug:!1};$.extend(c,b),$.extend(b,c),a.debugEnabled(b.debug)}]),angular.module("cv").run(["$timeout","$log","cvOptions","cubesService","cubesCacheService",function(a,b,c,d,e){b.debug("CubesViewer debug mode is enabled."),e.initialize(),d.connect()}]);var cubesviewer=new CubesViewer;cubesviewer.View=function(a,b,c){var d={};return d.id="_cv-view-"+b,d.type=c,d.cvOptions=a,d.state=cubesviewer.VIEW_STATE_INITIALIZING,d.error="",d.params={},d.savedId=0,d.owner=a.user,d.shared=!1,d.getControlsHidden=function(){return!!d.params.controlsHidden||!!d.cvOptions.hideControls},d.setControlsHidden=function(a){d.params.controlsHidden=a},d},angular.module("cv.views",["cv.views.cube"]),angular.module("cv.views").service("viewsService",["$rootScope","$window","cvOptions","cubesService","dialogService",function(a,b,c,d,e){this.views=[],this.lastViewId=0,this.studioViewsService=null,this.createView=function(a,b){this.lastViewId++;var d={};if("string"==typeof b)try{d=$.parseJSON(b)}catch(f){console.debug("Error: could not process serialized data (JSON parse error)"),e.show("Error: could not process serialized data (JSON parse error)."),d.name="Undefined view"}else d=b;var g=cubesviewer.CubeView(c,this.lastViewId,a);return $.extend(g.params,d),g},this.serializeView=function(a){return angular.toJson(a.params)}}]),angular.module("cv.views").service("dialogService",["$rootScope","$uibModal","cvOptions","cubesService",function(a,b,c,d){this.initialize=function(){$("body").append('<div class="cv-modals cv-bootstrap"></div>')},this.show=function(a){var c=b.open({animation:!0,templateUrl:"dialog/dialog.html",controller:"CubesViewerViewsDialogController",appendTo:angular.element($("body").find(".cv-modals")[0]),resolve:{dialog:function(){return{text:a}}}});c.result.then(function(a){},function(){})},this.initialize()}]),angular.module("cv.views").controller("CubesViewerViewsDialogController",["$rootScope","$scope","$timeout","$uibModalInstance","cvOptions","cubesService","viewsService","dialog",function(a,b,c,d,e,f,g,h){b.$rootScope=a,b.dialog=h,b.close=function(){d.dismiss("cancel")}}]),cubesviewer.CubeView=function(a,b,c){var d=cubesviewer.View(a,b,c);return d.resultLimitHit=!1,d.requestFailed=!1,d.pendingRequests=0,d.dimensionFilter=null,d._invalidatedData=!0,d._invalidatedDefs=!0,d.grid={api:null,data:[],columnDefs:[]},d.invalidateData=function(){d._invalidatedData=!0},d.invalidateDefs=function(){d._invalidatedData=!0,d._invalidatedDefs=!0},d.setViewMode=function(a){d.params.mode=a,d.invalidateDefs()},d},angular.module("cv.views.cube",[]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeController",["$rootScope","$log","$window","$injector","$scope","$timeout","cvOptions","cubesService","viewsService","exportService","rowSorter","dialogService",function($rootScope,$log,$window,$injector,$scope,$timeout,cvOptions,cubesService,viewsService,exportService,rowSorter,dialogService){$scope.viewController={},$scope.$rootScope=$rootScope,$scope.viewsService=viewsService,$scope.cvOptions=cvOptions,$scope.cubesService=cubesService,$scope.exportService=exportService,$scope.reststoreService=null,$injector.has("reststoreService")&&($scope.reststoreService=$injector.get("reststoreService")),$scope.refreshView=function(){$scope.view&&$scope.view.cube&&$scope.$broadcast("ViewRefresh",$scope.view)},$scope.setViewMode=function(a){console.debug("Remove setViewMode call on the controller?"),$scope.view.setViewMode(a)},$scope.initCube=function(){$scope.view.cube=null;var a={mode:"explore",drilldown:[],cuts:[],datefilters:[],columnHide:{},columnWidths:{},columnSort:{}},b=cubesService.cubesserver.get_cube($scope.view.params.cubename,function(b){$scope.view.cube=b,$log.debug($scope.view.cube),"cv-view-params"in $scope.view.cube.info?$scope.view.params=$.extend({},a,$scope.view.cube.info["cv-view-params"],$scope.view.params):$scope.view.params=$.extend({},a,$scope.view.params),$scope.view.state=cubesviewer.VIEW_STATE_INITIALIZED,$scope.view.error="",$rootScope.$apply()});b.fail(function(a){var b=a.responseJSON;$scope.view.state=cubesviewer.VIEW_STATE_ERROR,$scope.view.error="Error loading model: "+b.message+" ("+b.error+")",console.debug(b),$rootScope.$apply()})},$scope.requestErrorHandler=function(){$scope.view.requestFailed=!0},$scope.resetGrid=function(){rowSorter.colSortFnCache={}},$scope.onGridRegisterApi=function(a){$scope.view.grid.api=a,a.selection.on.rowSelectionChanged($scope,function(a){}),a.selection.on.rowSelectionChangedBatch($scope,function(a){}),a.core.on.columnVisibilityChanged($scope,function(a){a.visible?delete $scope.view.params.columnHide[a.field]:($scope.view.params.columnHide[a.field]=!0,delete $scope.view.params.columnWidths[a.field]),$scope.view.updateUndo()}),a.core.on.sortChanged($scope,function(a,b){$scope.view.params.columnSort[$scope.view.params.mode]={},$(b).each(function(a,b){$scope.view.params.columnSort[$scope.view.params.mode][b.field]={direction:b.sort.direction,priority:b.sort.priority}}),$scope.view.updateUndo()}),a.colResizable.on.columnSizeChanged($scope,function(b,c){var d=-1;$(a.grid.columns).each(function(a,c){c.field==b.field&&(d=a)}),d>=0&&($scope.view.params.columnWidths[b.field]=a.grid.columns[d].width),$scope.view.updateUndo()})},$scope.view.grid.onRegisterApi=$scope.onGridRegisterApi,$scope.validateData=function(a,b){$scope.view.requestFailed=!1,$scope.view.resultLimitHit=!1,("cells"in a&&a.cells.length>=cubesService.cubesserver.info.json_record_limit||a.length&&a.length>=cubesService.cubesserver.info.json_record_limit)&&($scope.view.resultLimitHit=!0)},$scope.newViewStateKey=function(){return $scope._viewStateKey=Math.floor(999999999999*Math.random()),$scope._viewStateKey},$scope.selectDrill=function(a,b){$scope.view.cube;a?($scope.removeDrill(a),1==b&&$scope.view.params.drilldown.push(a)):$scope.view.params.drilldown=[],$scope.refreshView()},$scope.removeDrill=function(a){$scope.view.params.drilldown=$.grep($scope.view.params.drilldown,function(b){return $scope.view.cube.dimensionParts(b).dimension.name==$scope.view.cube.dimensionParts(a).dimension.name},!0),$scope.refreshView()},$scope.columnFormatFunction=function(agmes){var view=$scope.view,measure=agmes;if(!measure)return function(a){return a};"measure"in agmes&&(measure=$.grep(view.cube.measures,function(a,b){return a.ref==agmes.measure})[0]);var formatterFunction=null;return formatterFunction=measure&&"cv-formatter"in measure.info?function(value,row){return eval(measure.info["cv-formatter"])}:function(a){return Math.formatnumber(a,"record_count"==agmes.ref?0:2)}},$scope.selectCut=function(a,b,c){var d=$scope.view;a?b?(d.params.cuts=$.grep(d.params.cuts,function(b){return d.cube.dimensionParts(b.dimension).cutDimension==d.cube.dimensionParts(a).cutDimension},!0),d.params.cuts.push({dimension:d.cube.dimensionParts(a).cutDimension,value:b,invert:c})):d.params.cuts=$.grep(d.params.cuts,function(b){return d.cube.dimensionParts(b.dimension).cutDimension==d.cube.dimensionParts(a).cutDimension},!0):d.params.cuts=[],$scope.refreshView()},$scope.filterSelected=function(){var a=$scope.view;if(1!=a.params.drilldown.length)return void dialogService.show("Can only filter multiple values in a view with one level of drilldown.");
if(a.grid.api.selection.getSelectedCount()<=0)return void dialogService.show("Cannot filter. No rows are selected.");var b=[],c=a.grid.api.selection.getSelectedRows();$(c).each(function(a,c){b.push(c.key0.cutValue)});var d=!1;$scope.selectCut(a.grid.columnDefs[0].cutDimension,b.join(";"),d)},$scope.showDimensionFilter=function(a){var b=$scope.view.cube.dimensionParts(a);$scope.view.dimensionFilter&&$scope.view.dimensionFilter==b.drilldownDimension?$scope.view.dimensionFilter=null:$scope.view.dimensionFilter=b.drilldownDimension},$scope.selectMeasure=function(a){$scope.view.params.yaxis=a,$scope.refreshView()},$scope.selectXAxis=function(a){$scope.view.params.xaxis=""==a?null:a,$scope.refreshView()},$scope.selectChartType=function(a){$scope.view.params.charttype=a,$scope.refreshView()},$scope.selectCalculation=function(a){$scope.view.params.calculation=a,$scope.refreshView()},$scope.showSerializeView=function(a){studioViewsService.studioScope.showSerializeView(a)},$scope.selectDateFilter=function(a,b){var c=$scope.view;c.cube;if(""!=a){if("1"==b)c.params.datefilters.push({dimension:a,mode:"auto-last3m",date_from:null,date_to:null});else for(var d=0;d<c.params.datefilters.length;d++)if(c.params.datefilters[d].dimension.split(":")[0]==a){c.params.datefilters.splice(d,1);break}}else c.params.datefilters=[];$scope.refreshView()},$scope.clearFilters=function(){$scope.view.params.cuts=[],$scope.view.params.datefilters=[],$scope.refreshView()},$scope.defineColumnWidth=function(a,b){return a in $scope.view.params.columnWidths?$scope.view.params.columnWidths[a]:b},$scope.defineColumnSort=function(a){var b=null;return $scope.view.params.columnSort[$scope.view.params.mode]&&$scope.view.params.columnSort[$scope.view.params.mode][a]&&(b={direction:$scope.view.params.columnSort[$scope.view.params.mode][a].direction,priority:$scope.view.params.columnSort[$scope.view.params.mode][a].priority}),b},$scope.sortValues=function(a,b){return"number"==typeof a&&"number"==typeof b?a-b:"string"==typeof a&&"string"==typeof b?$.isNumeric(a)&&$.isNumeric(b)?parseFloat(a)-parseFloat(b):a.localeCompare(b):null==a&&null==b?0:null==a?1:null==b?-1:a-b},$scope.sortDimensionParts=function(a){var b=a,c=function(a,c,d,e,f){for(var g=0,h=0;0==g&&h<b.hierarchy.levels.length;h++){var i=b.hierarchy.levels[h],j=i.order_attribute(),k=j.ref;if(!(k in d.entity._cell&&k in e.entity._cell))break;g=$scope.sortValues(d.entity._cell[k],e.entity._cell[k])}return g};return c},$scope.sortDimensionLevel=function(a){var b=function(b,c,d,e,f){var g=0,h=a.order_attribute(),i=h.ref;return i in d.entity._cell&&i in e.entity._cell&&(g=$scope.sortValues(d.entity._cell[i],e.entity._cell[i])),g};return b},$scope.onResize=function(){$rootScope.$broadcast("ViewResize")},angular.element($window).on("resize",$scope.onResize),$scope.$on("$destroy",function(){angular.element($window).off("resize",$scope.onResize)})}]).directive("cvViewCube",function(){return{restrict:"A",templateUrl:"views/cube/cube.html",scope:{view:"="},controller:"CubesViewerViewsCubeController",link:function(a,b,c){a.initCube()}}}),Math.formatnumber=function(a,b,c,d){if(void 0===a)return"";void 0===b&&(b=2),void 0===c&&(c="."),void 0===d&&(d=" ");for(var e="",f=Math.abs(a),g=Math.floor(f).toString(),h=0;h<g.length;h++){e+=g[h];var i=g.length-h-1;i>0&&i%3==0&&(e+=d)}return b>0&&(e+=parseFloat(f-Math.floor(f)).toFixed(b).toString().replace(".",c).substring(1)),0>a&&(e="-"+e),e},angular.module("cv.views.cube").controller("CubesViewerViewsCubeExploreController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService","dialogService","uiGridConstants",function(a,b,c,d,e,f,g,h){b.view.grid.enableRowSelection=!0,b.view.grid.enableRowHeaderSelection=!0,b.initialize=function(){b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=e.buildBrowserArgs(b.view,!1,!1),d=new cubes.Browser(e.cubesserver,b.view.cube),f=b.newViewStateKey(),g=d.aggregate(c,b._loadDataCallback(f));b.view.pendingRequests++,g.always(function(){b.view.pendingRequests--,a.$apply()}),g.error(b.requestErrorHandler)},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.exploreCut=function(a,c,d){if(b.selectCut(a,c,d),1==b.view.params.drilldown.length){var e=b.view.cube.dimensionParts(b.view.params.drilldown[0]);if(e.levelIndex<e.hierarchy.levels.length-1){var f=e.dimension.name+("default"!=e.hierarchy.name?"@"+e.hierarchy.name:"")+":"+e.hierarchy.levels[e.levelIndex+1].name;b.selectDrill(f,!0)}}},b.processData=function(c){var f=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply(),angular.extend(f.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!0,enableGridMenu:!0,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:f.params.drilldown.length>0,enablePinning:!1,multiSelect:!0,selectionRowHeaderWidth:20,columnDefs:[]}),$(f.cube.aggregates).each(function(a,d){var e={name:d.label,field:d.ref,index:d.ref,cellClass:"text-right",type:"number",headerCellClass:"cv-grid-header-measure",width:b.defineColumnWidth(d.ref,115),visible:!f.params.columnHide[d.ref],cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:b.columnFormatFunction(d),sort:b.defineColumnSort(d.ref)};e.footerValue=b.columnFormatFunction(d)(c.summary[d.ref],null,e),e.footerCellTemplate='<div class="ui-grid-cell-contents text-right">{{ col.colDef.footerValue }}</div>',f.grid.columnDefs.push(e)}),b._addRows(c);var g=[];$(f.params.drilldown).each(function(a,b){g.push(f.cube.cvdim_dim(b).label)});for(var h=0;h<f.params.drilldown.length;h++){var i=(f.cube.cvdim_dim(f.params.drilldown[h]),f.cube.dimensionParts(f.params.drilldown[h])),j=f.params.drilldown[h],k="";0==h&&(k=0==e.buildQueryCuts(f).length?"<b>Summary</b>":'<b>Summary <i style="color: #ddaaaa;">(Filtered)</i></b>'),f.grid.columnDefs.splice(h,0,{name:g[h],field:"key"+h,index:"key"+h,headerCellClass:"cv-grid-header-dimension",enableHiding:!1,cutDimension:j,width:b.defineColumnWidth("key"+h,190),cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP"><a href="" ng-click="grid.appScope.exploreCut(col.colDef.cutDimension, COL_FIELD.cutValue, false)">{{ COL_FIELD.title }}</a></div>',footerCellTemplate:'<div class="ui-grid-cell-contents">'+k+"</div>",sort:b.defineColumnSort("key"+h),sortingAlgorithm:b.sortDimensionParts(i)})}0==f.params.drilldown.length&&f.grid.columnDefs.splice(0,0,{name:f.cube.label,field:"key0",index:"key0",enableHiding:!1,align:"left",width:b.defineColumnWidth("key0",190),sort:b.defineColumnSort("key0")})},b._addRows=function(a){var c=b.view,d=c.grid.data;if($(a.cells).each(function(a,b){for(var e=[],f={},g=[],h=0;h<c.params.drilldown.length;h++){var i=(c.cube.cvdim_dim(c.params.drilldown[h]),c.cube.dimensionParts(c.params.drilldown[h])),j=i.hierarchy.readCell(b,i.level),k=[],l=[];$(j).each(function(a,b){k.push(b.key),l.push(b.label)}),e.push(k.join("-"));i.dimension.name+("default"!=i.hierarchy.name?"@"+i.hierarchy.name:"");g.push({cutValue:k.join(","),title:l.join(" / ")})}f.key=g.join(" / ");for(var h=0;h<g.length;h++)f["key"+h]=g[h];$(c.cube.aggregates).each(function(a,c){f[c.ref]=b[c.ref]}),f.id=e.join("-"),f._cell=b,d.push(f)}),0==d.length&&a.summary){var f={},g=0==e.buildQueryCuts(c).length?"Summary":"Summary (Filtered)";f.key0=g,$(c.cube.aggregates).each(function(b,c){f[c.ref]=a.summary[c.ref]}),d.push(f)}},b._sortData=function(a,b){},b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFilterDimensionController",["$rootScope","$scope","$filter","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f){b.parts=null,b.dimensionValues=null,b.loadingDimensionValues=!1,b.searchString="",b.selectedValues=null,b.filterInverted=null,b.filterShowAll=!1,b.currentDataId=null,b.initialize=function(){for(var a=b.view,c=a.cube.dimensionParts(b.view.dimensionFilter),d=0;d<a.params.cuts.length;d++)if(a.params.cuts[d].dimension==c.cutDimension){b.filterInverted=a.params.cuts[d].invert;break}},b.$watch("view.dimensionFilter",function(){b.parts=b.view.cube.dimensionParts(b.view.dimensionFilter),b.loadDimensionValues()}),b.$on("ViewRefresh",function(a){b.loadDimensionValues()}),b.$watch("filterShowAll",function(a){b.loadDimensionValues()}),b.closeDimensionFilter=function(){b.view.dimensionFilter=null},b.loadDimensionValues=function(){var a={hierarchy:b.parts.hierarchy.name,depth:b.parts.depth};if(!b.filterShowAll){var c=b.view.cube.dimensionParts(b.view.dimensionFilter),d=e.buildQueryCutsStrings(b.view);d.length>0&&(d=$.grep(d,function(a){return 0!=a.indexOf(c.dimension.name)&&0!=a.indexOf("!"+c.dimension.name)}),a.cut=d.join(cubes.CUT_STRING_SEPARATOR_CHAR))}var f="/cube/"+b.view.cube.name+"/members/"+b.parts.dimension.name,g=f+"?"+$.param(a);if(b.currentDataId!=g){b.currentDataId=g;var h=b.view.dimensionFilter;b.loadingDimensionValues=!0;var i=e.cubesRequest(f,a,b._loadDimensionValuesCallback(h));i.always(function(){b.loadingDimensionValues=!1,b.$apply()})}},b._loadDimensionValuesCallback=function(a){var a=a;return function(c,d){b.view.dimensionFilter==a&&b._processDimensionValuesData(c)}},b.filterDimensionValue=function(a){return function(b){var c=a.toLowerCase();return""==a||b.label.toLowerCase().indexOf(c)>=0}},b.selectAll=function(){var a=b.filterDimensionValue(b.searchString);$(b.dimensionValues).each(function(b,c){a(c)&&(c.selected=!0)})},b.selectNone=function(){var a=b.filterDimensionValue(b.searchString);$(b.dimensionValues).each(function(b,c){a(c)&&(c.selected=!1)})},b._processDimensionValuesData=function(a){for(var c=b.view,d=(b.view.cube.cvdim_dim(b.view.dimensionFilter),[]),e=(c.cube.dimensionParts(b.view.dimensionFilter),[]),f=0;f<c.params.cuts.length;f++)if(c.params.cuts[f].dimension==c.cube.dimensionParts(b.view.dimensionFilter).cutDimension){b.filterInverted=c.params.cuts[f].invert,e=c.params.cuts[f].value.split(";");break}$(a.data).each(function(a,c){var f=b.view.cube.dimensionParts(b.view.dimensionFilter),g=f.hierarchy.readCell(c,f.level),h=[],i=[];$(g).each(function(a,b){h.push(b.key),i.push(b.label)}),d.push({label:i.join(" / "),value:h.join(","),selected:e.indexOf(h.join(","))>=0})}),b.dimensionValues=d,b.$apply()},b.applyFilter=function(){var a=(b.view,[]);$(b.dimensionValues).each(function(b,c){c.selected&&a.push(c.value)}),a.length>=b.dimensionValues.length&&(a=[]);var c=b.parts.dimension.name+("default"!=b.parts.hierarchy.name?"@"+b.parts.hierarchy.name:"")+":"+b.parts.level.name;b.selectCut(c,a.join(";"),b.filterInverted)},b.initialize()}]),angular.module("cv.views.cube").filter("datefilterMode",["$rootScope","cvOptions",function(a,b){return function(a){var b="None";switch(a){case"custom":b="Custom";break;case"auto-last1m":b="Last month";break;case"auto-last3m":b="Last 3 months";break;case"auto-last6m":b="Last 6 months";break;case"auto-last12m":b="Last year";break;case"auto-last24m":b="Last 2 years";break;case"auto-january1st":b="From January 1st";break;case"auto-yesterday":b="Yesterday"}return b}}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFilterDateController",["$rootScope","$scope","$filter","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f){b.initialize=function(){b.dateStart.value=b.datefilter.date_from?new Date(b.datefilter.date_from):null,b.dateEnd.value=b.datefilter.date_to?new Date(b.datefilter.date_to):null},b.dateStart={opened:!1,value:null,options:{formatYear:"yyyy",startingDay:d.datepickerFirstDay,showWeeks:d.datepickerShowWeeks}},b.dateEnd={opened:!1,value:null,options:{formatYear:"yyyy",startingDay:d.datepickerFirstDay,showWeeks:d.datepickerShowWeeks}},b.dateStartOpen=function(){b.dateStart.opened=!0},b.dateEndOpen=function(){b.dateEnd.opened=!0},b.setMode=function(a){b.datefilter.mode=a},b.updateDateFilter=function(){b.datefilter.date_from=b.dateStart.value?c("date")(b.dateStart.value,"yyyy-MM-dd"):null,b.datefilter.date_to=b.dateEnd.value?c("date")(b.dateEnd.value,"yyyy-MM-dd"):null,b.refreshView()},b.$watch("dateStart.value",b.updateDateFilter),b.$watch("dateEnd.value",b.updateDateFilter),b.$watch("datefilter.mode",b.updateDateFilter),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFactsController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f){b.view.grid.enableRowSelection=!1,b.view.grid.enableRowHeaderSelection=!1,b.initialize=function(){b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=e.buildBrowserArgs(b.view,!1,!1),d=new cubes.Browser(e.cubesserver,b.view.cube),f=b.newViewStateKey(),g=d.facts(c,b._loadDataCallback(f));b.view.pendingRequests++,g.always(function(){b.view.pendingRequests--,a.$apply()}),g.error(b.requestErrorHandler)},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.processData=function(c){var e=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply();var f=e.cube.dimensions,g=e.cube.measures,h=e.cube.details;angular.extend(b.view.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!1,enableGridMenu:!0,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:!1,enableRowHeaderSelection:!1,enablePinning:!1,multiSelect:!1,columnDefs:[]}),e.grid.columnDefs.push({name:"id",field:"id",index:"id",enableHiding:!1,width:80});for(var i in f)for(var j=f[i],k=0;k<j.levels.length;k++){var l=j.levels[k],m={name:l.label,field:l.key().ref,index:l.key().ref,headerCellClass:"cv-grid-header-dimension",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ row.entity[col.colDef.field] }}</div>',visible:!e.params.columnHide[l.key().ref],width:b.defineColumnWidth(l.key().ref,95),sort:b.defineColumnSort(l.key().ref),sortingAlgorithm:b.sortDimensionLevel(l)};e.grid.columnDefs.push(m),$(l.attributes).each(function(a,c){if(c.ref!=l.key().ref&&c.ref!=l.label_attribute().ref){var d={name:c.name,field:c.ref,index:c.ref,headerCellClass:"cv-grid-header-dimensionattribute",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ row.entity[col.colDef.field] }}</div>',visible:!e.params.columnHide[c.ref],width:b.defineColumnWidth(c.ref,85),sort:b.defineColumnSort(c.ref)};e.grid.columnDefs.push(d)}})}for(var n in g){var o=g[n],m={name:o.label,field:o.ref,index:o.ref,cellClass:"text-right",headerCellClass:"cv-grid-header-measure",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:b.columnFormatFunction(o),visible:!e.params.columnHide[o.ref],width:b.defineColumnWidth(o.ref,75),sort:b.defineColumnSort(o.ref)};e.grid.columnDefs.push(m)}for(var p in h){var q=h[p],m={name:q.name,field:q.ref,index:q.ref,visible:!e.params.columnHide[q.ref],width:b.defineColumnWidth(q.ref,95),sort:b.defineColumnSort(q.ref),sortingAlgorithm:b.sortValues};e.grid.columnDefs.push(m)}b._addRows(c)},b._addRows=function(a){var c=b.view,d=c.grid.data,e=0,f=c.cube.dimensions,g=c.cube.measures,h=c.cube.details;$(a).each(function(a,b){var c=[];for(var i in f)for(var j=f[i],k=0;k<j.levels.length;k++){var l=j.levels[k],m=l.readCell(b);c[l.key().ref]=m.label,$(l.attributes).each(function(a,b){b.ref!=l.key().ref&&b.ref!=l.label_attribute().ref&&(c[b.ref]=m.info[b.ref])})}for(var n in g){var o=g[n];c[o.ref]=b[o.ref]}for(var p in h){var q=h[p];c[q.ref]=b[q.ref]}c.id=e++,"id"in b&&(c.id=b.id),c.key=c.id,c._cell=b,d.push(c)})},b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeSeriesController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService","seriesOperationsService",function(a,b,c,d,e,f,g){b.view.grid.enableRowSelection=!1,b.view.grid.enableRowHeaderSelection=!1,b.initialize=function(){b.view.params=$.extend({},{xaxis:null,yaxis:null},b.view.params),b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=b.view;if(null!=c.params.yaxis){var d=e.buildBrowserArgs(b.view,null!=b.view.params.xaxis?!0:!1,!1),f=new cubes.Browser(e.cubesserver,b.view.cube),g=b.newViewStateKey(),h=f.aggregate(d,b._loadDataCallback(g));b.view.pendingRequests++,h.always(function(){b.view.pendingRequests--,a.$apply()}),h.error(b.requestErrorHandler)}},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.processData=function(c){var e=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply(),angular.extend(b.view.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!1,enableGridMenu:!0,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:!1,enableRowHeaderSelection:!1,enablePinning:!1,multiSelect:!1,selectionRowHeaderWidth:20,columnDefs:[]}),b._addRows(b,c),g.applyCalculations(b.view,b.view.grid.data,e.grid.columnDefs)},b._addRows=cubesviewer._seriesAddRows,b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),cubesviewer._seriesAddRows=function(a,b){var c=a.view,d=c.grid.data,e=(c.cube.dimensions,c.cube.measures,c.cube.details,c.params.drilldown.slice(0));null!=c.params.xaxis&&e.splice(0,0,c.params.xaxis);var f=null==c.params.xaxis?0:1,g=[];if($(b.cells).each(function(b,h){for(var i=[],j=[],k=0;k<e.length;k++){var l=c.cube.dimensionParts(e[k]),m=l.hierarchy.readCell(h,l.level),n=[],o=[];$(m).each(function(a,b){n.push(b.key),o.push(b.label)}),j.push(o.join(" / "))}var p=null==c.params.xaxis?c.params.yaxis:j[0],q=h[c.params.yaxis],r=null==c.params.xaxis?j.join(" / "):j.slice(1).join(" / "),i=$.grep(d,function(a){return a.key==r});if(i.length>0)i[0][p]=q,i[0]._cell=h;else{var s={};s.key=r,s[p]=q;for(var k=f;k<j.length;k++)s["key"+(k-f)]=j[k];s._cell=h,d.push(s)}if(g.indexOf(p)<0){g.push(p);var t=$.grep(c.cube.aggregates,function(a){return a.ref==c.params.yaxis})[0],u={name:p,field:p,index:p,cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:a.columnFormatFunction(t),enableHiding:!1,width:a.defineColumnWidth(p,90),sort:a.defineColumnSort(p)};c.grid.columnDefs.push(u)}}),$(c.params.drilldown).each(function(b,d){var e={name:c.cube.cvdim_dim(d).label,field:"key"+b,index:"key"+b,headerCellClass:"cv-grid-header-dimension",enableHiding:!1,width:a.defineColumnWidth("key"+b,190),sort:a.defineColumnSort("key"+b),sortingAlgorithm:a.sortDimensionParts(c.cube.dimensionParts(d))};c.grid.columnDefs.splice(b,0,e)}),0==c.params.drilldown.length&&d.length>0){d[0].key0=c.cube.aggregateFromName(c.params.yaxis).label;var h={name:"Measure",field:"key0",index:"key0",headerCellClass:"cv-grid-header-measure",enableHiding:!1,width:a.defineColumnWidth("key0",190),sort:a.defineColumnSort("key0")};c.grid.columnDefs.splice(0,0,h)}},angular.module("cv.views").service("seriesOperationsService",["$rootScope","cvOptions","cubesService",function(a,b,c){this.calculateDifferentials=function(a,b,c){console.debug("FIXME: Differentials are ignoring drilldown.length columns, but fails in some cases."),$(b).each(function(b,d){for(var e=null,f=a.params.drilldown.length;f<c.length;f++){var g=d[c[f].field],h=null;if(null!=e&&null!=g){var h=g-e;d[c[f].field]=h}else delete d[c[f].field];e=g}})},this.calculateDifferentialsPercent=function(a,b,c){console.debug("FIXME: Differentials are ignoring drilldown.length columns, but fails in some cases."),$(b).each(function(b,d){for(var e=null,f=a.params.drilldown.length;f<c.length;f++){var g=d[c[f].field],h=null;if(null!=e&&null!=g){var h=(g-e)/e;d[c[f].field]=h}else delete d[c[f].field];e=g}})},this.calculateAccum=function(a,b,c){},this.applyCalculations=function(a,b,c){"difference"==a.params.calculation&&this.calculateDifferentials(a,b,c),"percentage"==a.params.calculation&&this.calculateDifferentialsPercent(a,b,c)}}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartController",["$rootScope","$scope","$timeout","$element","cvOptions","cubesService","viewsService","seriesOperationsService","exportService",function(a,b,c,d,e,f,g,h,i){var j=this;this.chart=null,this.initialize=function(){b.view.params=$.extend({},{charttype:"bars-vertical",chartoptions:{showLegend:!0}},b.view.params)},b.$watch("view.params.charttype",function(){j.loadData()}),b.$on("ViewRefresh",function(a){j.loadData()}),this.loadData=function(){var c=b.view;if(null!=c.params.yaxis){var d=f.buildBrowserArgs(b.view,null!=b.view.params.xaxis?!0:!1,!1),e=new cubes.Browser(f.cubesserver,b.view.cube),g=b.newViewStateKey(),h=e.aggregate(d,b._loadDataCallback(g));b.view.pendingRequests++,h.always(function(){b.view.pendingRequests--,a.$apply()}),h.error(b.requestErrorHandler)}},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),j.processData(d),a.$apply())}},this.processData=function(c){0==b.view.pendingRequests&&($(d).find("svg").empty(),$(d).find("svg").parent().children().not("svg").remove()),b.rawData=c,b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply();var e=b.view,f=b.view.grid.data,g=e.grid.columnDefs;this._addRows(b,c),h.applyCalculations(b.view,b.view.grid.data,e.grid.columnDefs),e.params.drilldown.length>0&&(g.splice(0,e.params.drilldown.length,{name:"key"}),$(f).each(function(a,b){for(var c=[],d=0;d<e.params.drilldown.length;d++)c.push(b["key"+d]);b.key=c.join(" / ")})),b.$broadcast("gridDataUpdated")},this._addRows=cubesviewer._seriesAddRows,this.cleanupNvd3=function(){$(d).find("svg").parent().children().not("svg").remove(),j.chart&&$("#"+j.chart.tooltip.id()).remove()},b.$watch("cvOptions.studioTwoColumn",function(){j.chart&&c(function(){j.chart.update()},100)}),this.resizeChart=function(a){b.view;$(d).find("svg").height(a),$(d).find("svg").resize(),j.chart&&j.chart.update()},b.$on("ViewResize",function(a){j.chart&&j.chart.update()}),b.view.exportChartAsPNG=function(){var a='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',c=i.getDocumentStyles();c=void 0===c?"":c;var e=$(d).find("svg").first();e.addClass("cv-bootstrap"),e.css("font-size","10px"),e.css("font-family","Helvetica, Arial, sans-serif"),e.css("background-color","white"),e.attr("width",e.width()),e.attr("height",e.height()),e.attr("version","1.1");var f=document.createElement("defs");e[0].insertBefore(f,e[0].firstChild);var g=document.createElement("style");f.appendChild(g),g.setAttribute("type","text/css");var h=(new XMLSerializer).serializeToString(e.get(0));h=h.replace("</style>","<![CDATA["+c+"]]></style>");var j=new Blob([a+h],{type:"image/svg+xml;charset=utf-8"}),k=window.URL.createObjectURL(j),l=d3.select("body").append("img").attr("visibility","hidden").attr("width",e.width()).attr("height",e.height()).node();l.onload=function(){var a=d3.select("body").append("canvas").node();$(a).addClass("cv-bootstrap"),$(a).attr("visibility","hidden"),a.width=e.width(),a.height=e.height();var c=a.getContext("2d");c.drawImage(l,0,0,e.width(),e.height());var d=a.toDataURL("image/png");$(l).remove(),$(a).remove(),i.saveAs(d,b.view.cube.name+"-"+b.view.params.charttype+".png")},l.src=k},b.$on("$destroy",function(){j.cleanupNvd3(),b.view.grid.data=[],b.view.grid.columnDefs=[]}),this.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartBarsVerticalController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartBarsVertical()},0)}),b.drawChartBarsVertical=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,f=$(c).find("svg").get(0),g=null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"None",h=[],i=(d.length,0);$(d).each(function(b,c){for(var d=[],f=1;f<e.length;f++){var g=c[e[f].name];d.push({x:e[f].name,y:void 0!=g?g:0})}var j={values:d,key:""!=c.key?c.key:a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(j.disabled=!!a.params["chart-disabledseries"].disabled[j.key]),h.push(j),i++}),h.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var j={delay:1200,groupSpacing:.1},k=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],l=b.columnFormatFunction(k);nv.addGraph(function(){var c=nv.models.multiBarChart().showLegend(!!a.params.chartoptions.showLegend).margin({left:120});return a.params["chart-barsvertical-stacked"]&&c.stacked(a.params["chart-barsvertical-stacked"]),c.options(j),c.multibar.hideable(!0),c.xAxis.axisLabel(g),c.yAxis.tickFormat(function(a,b){return l(a)}),d3.select(f).datum(h).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-barsvertical-stacked"]=b.stacked,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[h[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartBarsHorizontalController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartBarsVertical()},0)}),b.drawChartBarsVertical=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,f=$(c).find("svg").get(0),g=(null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"None",[]),h=(d.length,0);$(d).each(function(b,c){for(var f=[],i=1;i<e.length;i++){var j=c[e[i].name];2==d.length&&1==h&&a.params.chartoptions.mirrorSerie2&&(j=void 0!=j?-j:0),f.push({x:e[i].name,y:void 0!=j?j:0})}f.reverse();var k={values:f,key:""!=c.key?c.key:a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(k.disabled=!!a.params["chart-disabledseries"].disabled[k.key]),g.push(k),h++}),g.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var i={delay:1200,groupSpacing:.1},j=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],k=b.columnFormatFunction(j);nv.addGraph(function(){var c=nv.models.multiBarHorizontalChart().showLegend(!!a.params.chartoptions.showLegend).margin({left:120}).showControls(!0);return a.params["chart-barsvertical-stacked"]&&c.stacked(a.params["chart-barsvertical-stacked"]),c.options(i),c.yAxis.tickFormat(function(b,c){return 2==d.length&&a.params.chartoptions.mirrorSerie2&&0>b&&(b=-b),k(b)}),d3.select(f).datum(g).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-barsvertical-stacked"]=b.stacked,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[g[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartLinesController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){!1 in b.view.params.chartoptions&&(b.view.params.chartoptions.lineInterpolation="linear")},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartLines()},0)}),b.drawChartLines=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,f=$(c).find("svg").get(0),g=null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"None",h=[],i=(d.length,0);$(d).each(function(b,c){for(var d=[],f=1;f<e.length;f++)if(e[f].field in c){var g=c[e[f].field];d.push({x:f,y:void 0!=g?g:0})}else"lines-stacked"==a.params.charttype&&d.push({x:f,y:0});var j={values:d,key:""!=c.key?c.key:a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(j.disabled=!!a.params["chart-disabledseries"].disabled[j.key]),h.push(j),i++}),h.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var j=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],k=b.columnFormatFunction(j);"lines-stacked"!=a.params.charttype?nv.addGraph(function(){var c=nv.models.lineChart().useInteractiveGuideline(!0).interpolate(b.view.params.chartoptions.lineInterpolation).showLegend(!!a.params.chartoptions.showLegend).margin({left:120});return c.xAxis.axisLabel(g).tickFormat(function(a,b){return e[a].name}),c.yAxis.tickFormat(function(a,b){return k(a)}),d3.select(f).datum(h).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[h[c].key]=b.disabled[c]}),b.chartCtrl.chart=c,c}):nv.addGraph(function(){var c=nv.models.stackedAreaChart().showLegend(!!a.params.chartoptions.showLegend).interpolate(b.view.params.chartoptions.lineInterpolation).margin({left:130}).clipEdge(!0).useInteractiveGuideline(!0);return a.params["chart-stackedarea-style"]&&c.style(a.params["chart-stackedarea-style"]),c.xAxis.axisLabel(g).showMaxMin(!1).tickFormat(function(a,b){return e[a].name}),c.yAxis.tickFormat(function(a,b){return k(a)}),d3.select(f).datum(h).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-stackedarea-style"]=b.style,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[h[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartPieController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartPie()},0)}),b.drawChartPie=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,f=$(c).find("svg").get(0),g=(null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"None",[]),h=(d.length,0);$(d).each(function(b,c){var d=c[e[1].field];if(void 0!=d&&d>0){var f={y:d,key:""!=c.key?c.key:e[0].name};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(f.disabled=!!a.params["chart-disabledseries"].disabled[f.key]),g.push(f),h++}}),g.sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:0});for(var i=[],j=1;j<e.length;j++)i.push([j-1,e[j].name]);var k=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],l=b.columnFormatFunction(k);nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.y}).showLegend(!!a.params.chartoptions.showLegend).margin({bottom:20,top:20}).labelType("percent");return c.valueFormat(function(a,b){return l(a)}),d3.select(f).datum(g).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[g[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartRadarController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){d(function(){b.drawChartRadar()},2e3)}),b.$watch("cvOptions.studioTwoColumn",function(){
d(function(){b.drawChartRadar()},2e3)}),b.$on("ViewResize",function(){b.$apply(function(){b.drawChartRadar()})}),b.drawChartRadar=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,f=$(c).find(".cv-chart-container")[0];$(f).empty(),$(f).height(400);var g=[],h=d.length;$(d).each(function(b,c){for(var d=[],f=1;f<e.length;f++){var h=c[e[f].field];void 0!=h?d.push([f-1,h]):d.push([f-1,0])}g.push({data:d,label:""!=c.key?c.key:a.params.yaxis})}),g.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0});for(var i=[],j=1;j<e.length;j++)i.push([j-1,e[j].name]);var k={HtmlText:!1,shadowSize:2,height:350,radar:{show:!0,fill:4>h,fillOpacity:.2},mouse:{track:!1,relative:!0},grid:{circular:!0,minorHorizontalLines:!0},xaxis:{ticks:i},yaxis:{},legend:{show:!!a.params.chartoptions.showLegend,position:"se",backgroundColor:"#D2E8FF"}};b.flotrDraw=Flotr.draw(f,g,k)},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartSunburstController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){d(function(){b.drawChartSunburst()},2e3)}),b.drawChartSunburst=function(){var a=b.view,c=b.rawData,d=(b.view.grid.data,a.grid.columnDefs,b.prepareDrilldownTree(c));b.draw3DJSSunburst(d)},b.prepareDrilldownTree=function(a){var c=b.view,d=[{children:[],name:"Current Slice"}],e=null;return $(a.cells).each(function(a,b){e=d[0];for(var f=0;f<c.params.drilldown.length;f++){var g=c.cube.dimensionParts(c.params.drilldown[f]),h=g.hierarchy.readCell(b);$(h).each(function(a,b){var c=$.grep(e.children,function(a){return a.name==b.key});c.length>0?e=c[0]:(c={children:[],name:String(b.key),label:b.label},e.children.push(c),e=c)})}e.measure=b[c.params.yaxis]}),d[0].children},String.prototype.hashCode=function(){var a,b,c,d=0;if(0===this.length)return d;for(a=0,c=this.length;c>a;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d},b.draw3DJSSunburst=function(a){function d(a,b){return a===b?!0:a.children&&a.children.length>0?a.children.some(function(a){return d(a,b)}):!1}function e(a){if(!a)return"#ffaaaa";if(void 0!=a.color)return a.color;if(null!=a.parent&&null!=a.parent.parent){a.color=e(a.parent);var b=u(Math.abs(String(a.name).hashCode())%20);a.color=d3.scale.linear().domain([0,100]).interpolate(d3.interpolateRgb).range([a.color,b])(30),a.color=b}else"name"in a?a.color=u(Math.abs(String(a.name).hashCode())%20):a.color="#ffffff";return a.color}function f(a){var b=g(a),c=d3.interpolate(q.domain(),[a.x,a.x+a.dx]),d=d3.interpolate(r.domain(),[a.y,b]),e=d3.interpolate(r.range(),[20,p]);return function(a){return function(b){return q.domain(c(b)),r.domain(d(b)).range(e(b)),z(a)}}}function g(a){return 1}function h(a){return.299*a.r+.587*a.g+.114*a.b}function i(a,b){var c=a.split(" "),d=c.length>8;return c.length<=2?0==b?a:"":(c=c.slice(0,8),c=0==b?c.slice(0,Math.floor(c.length/2)):c.slice(Math.floor(c.length/2)),c.join(" ")+(d&&1==b?"...":""))}function j(a){C.style("visibility",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;return b?null:"hidden"}).transition().duration(t).attrTween("text-anchor",function(a){return function(){return q(a.x+a.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(a){var b=(a.name||"").split(" ").length>1;return function(){var c=180*q(a.x+a.dx/2)/Math.PI-90,d=c+(b?-.5:0);return"rotate("+d+")translate("+(r(a.y)+s)+")rotate("+(c>90?-180:0)+")"}}).style("fill-opacity",function(b){return d(a,b)?1:1e-6}).each("end",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;d3.select(this).style("visibility",b?null:"hidden")})}function k(a){v=a,B.transition().duration(t).attrTween("d",f(a)),j(a)}var l=b.view,a=a,m=(b.rawData,l.grid.columnDefs,$(c).find("svg").parent().empty().get(0)),n=(null!=l.params.xaxis?l.cube.dimensionParts(l.params.xaxis).label:"None",470),o=n,p=n/2,q=d3.scale.linear().range([0*Math.PI,2*Math.PI]),r=d3.scale.linear().domain([0,1]).range([20,p]),s=5,t=1e3,u=d3.scale.category20b().domain([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),v=null,w=d3.select(m),x=w.append("svg").attr("width",n+2*s).attr("height",o+2*s).append("g").attr("transform","translate("+(p+s)+","+(p+s)+")"),y=d3.layout.partition().sort(null).value(function(a){return a.measure}),z=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,q(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,q(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,a.y?r(a.y):a.y)}).outerRadius(function(a){return Math.max(0,r(a.y+a.dy))}),A=y.nodes({children:a}),B=x.selectAll("path").data(A);B.enter().append("path").attr("id",function(a,b){return"path-"+b}).attr("d",z).attr("fill-rule","evenodd").style("fill",e).on("click",k).each(function(a,b){var c=this;$(c).hover(function(){d3.select(c).style("stroke","#ffffff").style("stroke-width","2").style("stroke-opacity","1"),$(c).insertBefore($("text").first())},function(){d3.select(c).style("stroke","#000000").style("stroke-width","0").style("stroke-opacity","0")})}),v=A[0];var C=x.selectAll("text").data(A),D=C.enter().append("text").style("fill-opacity",1).style("fill",function(a){return h(d3.rgb(e(a)))<125?"#eee":"#000"}).style("font-size",9).style("-webkit-touch-callout","none").style("-webkit-user-select","none").style("-khtml-user-select","none").style("-moz-user-select","none").style("-ms-user-select","none").style("user-select","none").style("pointer-events","none").style("visibility",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;return b=!0,b?null:"hidden"}).attr("text-anchor",function(a){return q(a.x+a.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(a){var b=(("label"in a?String(a.label):"")||"").split(" ").length>1,c=180*q(a.x+a.dx/2)/Math.PI-90,d=c+(b?-.5:0);return"rotate("+d+")translate("+(r(a.y)+s)+")rotate("+(c>90?-180:0)+")"}).on("click",k);D.append("tspan").attr("x",0).text(function(a){return a.depth?i(a.label,0):""}),D.append("tspan").attr("x",0).attr("dy","1em").text(function(a){return a.depth?i(a.label,1)||"":""})}}]),angular.module("cv.views.cube").service("exportService",["$rootScope","$timeout","cvOptions","cubesService","viewsService","seriesOperationsService",function(a,b,c,d,e,f){this.exportFacts=function(a){var b=d.buildBrowserArgs(a,!1,!0),e={};e.format="csv",b.cut&&(e.cut=b.cut.toString()),b.order&&(e.order=b.order.toString());var f=c.cubesUrl+"/cube/"+a.cube.name+"/facts?"+$.param(e);window.open(f,"_blank"),window.focus()},this.exportGridAsCsv=function(a){if(!a.grid)return void console.debug("View has no grid that can be exported.");var b=(a.grid,a.grid.data),c="",d=[];$(a.grid.columnDefs).each(function(a,b){d.push('"'+b.name+'"')}),c=c+d.join(",")+"\n",$(b).each(function(b,e){d=[],$(a.grid.columnDefs).each(function(a,b){e[b.field]&&e[b.field].title?d.push('"'+e[b.field].title+'"'):d.push('"'+e[b.field]+'"')}),c=c+d.join(",")+"\n"}),this.saveAs(c,"text/csv",a.cube.name+"-summary.csv")},this.saveAs=function(a,b,c){var d=new Blob([a],{type:b}),e=URL.createObjectURL(d),f=document.createElement("a");"string"==typeof f.download?(document.body.appendChild(f),f.download=c,f.href=e,f.click(),document.body.removeChild(f)):location.replace(e)},this.getDocumentStyles=function(){function a(b){try{if(b.cssRules){console.debug(b);for(var d=0;d<b.cssRules.length;d++){var e=b.cssRules[d];3===e.type?a(e.styleSheet):e.selectorText&&-1===e.selectorText.indexOf(">")&&(c+="\n"+e.cssText)}}}catch(f){console.debug("Could not access document stylesheet.")}}var b=window.document,c="",d=b.styleSheets;if(d)for(var e=0;e<d.length;e++)a(d[e]);return c}}]),angular.module("cv.views.cube").controller("CubesViewerViewsUndoController",["$rootScope","$scope","$timeout","$element","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.initialize=function(){b.view.undoList=[],b.view.undoPos=-1},b.initialize(),b.$on("ViewRefresh",function(a){b._processState(a)}),b._processState=function(){var a=g.serializeView(b.view),c=b.getCurrentUndoState();a!=c&&b.pushUndo(a)},b.pushUndo=function(a){var c=b.view;c.undoPos=c.undoPos+1,c.undoPos+1<=c.undoList.length&&c.undoList.splice(c.undoPos,c.undoList.length-c.undoPos),c.undoList.push(a),c.undoList.length>e.undoSize&&(c.undoList.splice(0,c.undoList.length-e.undoSize),c.undoPos=c.undoList.length-1)},b.view.updateUndo=function(){var a=b.view,c=g.serializeView(a);a.undoList[a.undoPos]&&(a.undoList[a.undoPos]=c)},b.getCurrentUndoState=function(){return 0==b.view.undoList.length?"{}":b.view.undoList[b.view.undoPos]},b.undo=function(){b.view.undoPos=b.view.undoPos-1,b.view.undoPos<0&&(b.view.undoPos=0),b.applyCurrentUndoState()},b.redo=function(){b.view.undoPos=b.view.undoPos+1,b.applyCurrentUndoState()},b.applyCurrentUndoState=function(){var a=b.getCurrentUndoState();b.view.params=$.parseJSON(a),b.refreshView()}}]),angular.module("cv.studio",["cv"]),angular.module("cv.studio").service("studioViewsService",["$rootScope","$anchorScroll","$timeout","cvOptions","cubesService","viewsService","dialogService",function(a,b,c,d,e,f,g){this.views=[],this.studioScope=null,f.studioViewsService=this,cubesviewerStudio.studioViewsService=this,this.addViewCube=function(a){var d=e.cubesserver.cubeinfo(a),g=d.label+" ("+(f.lastViewId+1)+")",h=f.createView("cube",{cubename:a,name:g});return this.views.push(h),c(function(){$(".cv-views-container").masonry("appended",$(".cv-views-container").find(".sv"+h.id).show()),c(function(){b("cvView"+h.id)},500)},0),h},this.addViewObject=function(a){if("string"==typeof a)try{$.parseJSON(a)}catch(d){return void g.show("Could not process serialized data: JSON parse error.")}var e=f.createView("cube",a);return this.views.push(e),c(function(){$(".cv-views-container").masonry("appended",$(".cv-views-container").find(".sv"+e.id).show()),c(function(){b("cvView"+e.id)},500)},0),e},this.closeView=function(a){var b=this.views.indexOf(a);b>=0&&($(".cv-views-container").masonry("remove",$(".cv-views-container").find(".sv"+a.id)),this.views.splice(b,1),$(".cv-views-container").masonry("layout"))},this.toggleCollapseView=function(a){a.collapsed=!a.collapsed,c(function(){$(".cv-views-container").masonry("layout")},100)}}]),angular.module("cv.studio").controller("CubesViewerStudioViewController",["$rootScope","$scope","cvOptions","cubesService","studioViewsService","reststoreService",function(a,b,c,d,e,f){b.cubesService=d,b.studioViewsService=e,b.cvOptions=c,b.reststoreService=f,b.$watch("__height",function(){$(".cv-views-container").masonry("layout")})}]).directive("cvStudioView",function(){return{restrict:"A",templateUrl:"studio/panel.html",scope:{view:"="},link:function(a,b,c){a.$watch(function(){a.__height=b.height()})}}}),angular.module("cv.studio").controller("CubesViewerStudioController",["$rootScope","$scope","$uibModal","$element","$timeout","cvOptions","cubesService","studioViewsService","viewsService","reststoreService",function(a,b,c,d,e,f,g,h,i,j){b.cvVersion=cubesviewer.version,b.cvOptions=f,b.cubesService=g,b.studioViewsService=h,b.reststoreService=j,b.studioViewsService.studioScope=b,b.initialize=function(){},b.showSerializeAdd=function(){var a=c.open({animation:!0,templateUrl:"studio/serialize-add.html",controller:"CubesViewerSerializeAddController",appendTo:angular.element($(d).find(".cv-gui-modals")[0])});a.result.then(function(a){},function(){})},b.showSerializeView=function(a){var b=c.open({animation:!0,templateUrl:"studio/serialize-view.html",controller:"CubesViewerSerializeViewController",appendTo:angular.element($(d).find(".cv-gui-modals")[0]),resolve:{view:function(){return a},element:function(){return $(d).find(".cv-gui-modals")[0]}}});b.result.then(function(a){},function(){})},b.showRenameView=function(a){var b=c.open({animation:!0,templateUrl:"studio/rename.html",controller:"CubesViewerRenameController",appendTo:angular.element($(d).find(".cv-gui-modals")[0]),size:"md",resolve:{view:function(){return a},element:function(){return $(d).find(".cv-gui-modals")[0]}}});b.result.then(function(a){},function(){})},b.cloneView=function(a){var b=$.parseJSON(i.serializeView(a));b.name="Clone of "+b.name;var a=h.addViewObject(b);a.savedId=0,a.owner=f.user,a.shared=!1},b.toggleTwoColumn=function(){f.studioTwoColumn=!f.studioTwoColumn,e(function(){$(".cv-views-container").masonry("layout")},100)},b.toggleHideControls=function(){f.hideControls=!f.hideControls,e(function(){$(".cv-views-container").masonry("layout")},100)},b.initialize()}]),angular.module("cv.studio").controller("CubesViewerRenameController",["$rootScope","$scope","$uibModalInstance","cvOptions","cubesService","studioViewsService","view",function(a,b,c,d,e,f,g){b.cvVersion=cubesviewer.version,b.cvOptions=d,b.cubesService=e,b.studioViewsService=f,b.viewName=g.params.name,b.renameView=function(a){null!=a&&""!=a&&(g.params.name=a),c.close(g)},b.close=function(){c.dismiss("cancel")}}]),angular.module("cv.studio").config(["$compileProvider",function(a){}]),angular.module("cv.studio").run(["$rootScope","$compile","$controller","$http","$templateCache","cvOptions",function(a,b,c,d,e,f){console.debug("Bootstrapping CubesViewer Studio.");var g={container:null,user:null,studioTwoColumn:!1,hideControls:!1,backendUrl:null};$.extend(g,f),$.extend(f,g),d.get("studio/studio.html",{cache:e}).then(function(c){var d=a.$new();$(f.container).html(c.data),b($(f.container).contents())(d)})}]);var cubesviewerStudio=new CubesViewerStudio;angular.module("cv.studio").controller("CubesViewerSerializeViewController",["$rootScope","$scope","$timeout","$uibModalInstance","element","cvOptions","cubesService","studioViewsService","viewsService","view",function(a,b,c,d,e,f,g,h,i,j){b.cvVersion=cubesviewer.version,b.cvOptions=f,b.cubesService=g,b.studioViewsService=h,b.serializedView="",b.initialize=function(){b.serializedView=i.serializeView(j),console.log("Serialized view: "+b.serializedView),c(function(){window.getSelection().removeAllRanges();var a=document.createRange();a.selectNodeContents($(e).find(".cv-serialized-view")[0]),window.getSelection().addRange(a)},0)},b.close=function(){d.dismiss("cancel")},b.initialize()}]),angular.module("cv.studio").controller("CubesViewerSerializeAddController",["$rootScope","$scope","$uibModalInstance","cvOptions","cubesService","studioViewsService",function(a,b,c,d,e,f){b.cvVersion=cubesviewer.version,b.cvOptions=d,b.cubesService=e,b.studioViewsService=f,b.serializedView=null,b.addSerializedView=function(a){if(null!=a){f.addViewObject(a)}c.close(a)},b.close=function(){c.dismiss("cancel")}}]),angular.module("cv.studio").service("reststoreService",["$rootScope","$http","$cookies","cvOptions","cubesService","viewsService","dialogService","studioViewsService",function(a,b,c,d,e,f,g,h){var i=this;i.savedViews=[],i.initialize=function(){d.backendUrl&&i.viewList()},i.getSavedView=function(a){var b=$.grep(i.savedViews,function(b){return b.id==a});return b.length>0?b[0]:null},i.saveView=function(a){if(a.owner!=d.user)return void g.show("Cannot save a view that belongs to other user (try cloning the view).");var h={id:a.savedId,name:a.params.name,shared:a.shared,data:f.serializeView(a)};b({method:"POST",url:d.backendUrl+"/view/save/",data:JSON.stringify(h),headers:{"X-CSRFToken":c.get("csrftoken")}}).then(i._viewSaveCallback(a),e.defaultRequestErrorHandler)},i._viewSaveCallback=function(a){var a=a;return function(b,c){if(b=b.data,null!=a){a.savedId=b.id;var d=i.getSavedView(a.savedId);null!=d&&(d.name=a.params.name,d.shared=a.shared,d.data=f.serializeView(a))}i.viewList(),g.show("View saved.")}},i.deleteView=function(a){if(0==a.savedId)return void g.show("Cannot delete this view as it hasn't been saved.");if(a.owner!=d.user)return void g.show("Cannot delete a view that belongs to other user.");if(confirm("Are you sure you want to delete and close this view?")){var e={id:a.savedId,data:""};h.closeView(a),b({method:"POST",url:d.backendUrl+"/view/save/",data:JSON.stringify(e),headers:{"X-CSRFToken":c.get("csrftoken")}}).then(i._viewDeleteCallback,cubesviewer.defaultRequestErrorHandler)}},i._viewDeleteCallback=function(){i.viewList()},i.viewList=function(){b.get(d.backendUrl+"/view/list/").then(i._viewListCallback,e.defaultRequestErrorHandler)},i._viewListCallback=function(a,b){i.savedViews=a.data},i.isViewChanged=function(a){if(0==a.savedId)return!1;var b=i.getSavedView(a.savedId);if(null!=b){if(a.params.name!=b.name)return!0;if(a.shared!=b.shared)return!0;if(f.serializeView(a)!=b.data)return!0}return!1},i.shareView=function(a,b){return a.owner!=d.user?void g.show("Cannot share/unshare a view that belongs to other user (try cloning the view)."):(a.shared=1==b?!0:!1,void i.saveView(a))},i.addSavedView=function(a){var b=i.getSavedView(a),c=$.parseJSON(b.data),e=h.addViewObject(c);b.owner==d.user?(e.savedId=b.id,e.owner=b.owner,e.shared=b.shared):(e.savedId=0,e.owner=d.user,e.shared=!1)},i.initialize()}]),angular.module("cv.cubes").service("gaService",["$rootScope","$http","$cookies","$log","cvOptions",function(a,b,c,d,e){this.ignorePeriod=12,this.initTime=new Date,this.initialize=function(){e.gaTrackEvents&&d.debug("Google Analytics events tracking plugin enabled.")},this.trackRequest=function(a){if(e.gaTrackEvents&&!((new Date-this.initTime)/1e3<this.ignorePeriod)){var b=null,c=a.split("/"),f=c.indexOf("cube");f>=0&&(c=c.slice(f+1),"model"==c[1]?b=["model",c[0]]:"aggregate"==c[1]?b=["aggregate",c[0]]:"facts"==c[1]?b=["facts",c[0]]:"members"==c[1]&&(b=["dimension",c[2]])),b?"undefined"!=typeof ga?(ga("send","event","CubesViewer",b[0],b[1]),d.debug("Tracking GA event: "+b[0]+"/"+b[1])):d.debug("Cannot track CubesViewer events: GA object 'ga' not available."):d.warn("Unknown cubes operation, cannot be tracked by GA service: "+a)}},this.initialize()}]),angular.module("cv").run(["$templateCache",function(a){a.put("dialog/dialog.html",'  <div class="modal-header">\n    <button type="button" ng-click="close()" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-exclamation"></i> CubesViewer</h4>\n  </div>\n  <div class="modal-body">\n        <p>{{ dialog.text }}</p>\n  </div>\n  <div class="modal-footer">\n    <!-- <button type="button" ng-click="close()" class="btn btn-secondary" data-dismiss="modal">Cancel</button>  -->\n    <button type="button" ng-click="close()" class="btn btn-primary" data-dismiss="modal">Close</button>\n  </div>\n\n'),a.put("studio/about.html",'<div class="modal fade" id="cvAboutModal" tabindex="-1" role="dialog" aria-labelledby="">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n        <h4 class="modal-title" id="myModalLabel"><i class="cv-logo-embedded"></i> CubesViewer</h4>\n      </div>\n      <div class="modal-body">\n\n            <p><a href="http://jjmontesl.github.io/cubesviewer/" target="_blank">CubesViewer</a> is a visual, web-based application for exploring and analyzing\n            OLAP databases served by the <a href="http://cubes.databrewery.org/" target="_blank">Cubes OLAP Framework</a>.</p>\n            <hr />\n\n            <p>Version {{ cvVersion }}<br />\n            <a href="https://github.com/jjmontesl/cubesviewer/" target="_blank">https://github.com/jjmontesl/cubesviewer/</a></p>\n\n            <p>by José Juan Montes and others (see AUTHORS)<br />\n            2012 - 2016</p>\n\n            <p>\n            <a href="http://github.com/jjmontesl/cubesviewer/blob/master/LICENSE.txt" target="_blank">LICENSE</a>\n            </p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-cube"></i> Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n'),a.put("studio/panel.html",'<div class="cv-bootstrap cv-gui-viewcontainer" ng-controller="CubesViewerStudioViewController">\n\n    <div class="panel panel-primary">\n        <div ng-if="! cvOptions.hideControls" class="panel-heading">\n\n            <button type="button" ng-click="studioViewsService.closeView(view)" class="btn btn-danger btn-xs pull-right hidden-print" style="margin-left: 10px;"><i class="fa fa-fw fa-close"></i></button>\n            <button type="button" ng-click="studioViewsService.toggleCollapseView(view)" class="btn btn-primary btn-xs pull-right hidden-print" style="margin-left: 5px;"><i class="fa fa-fw" ng-class="{\'fa-caret-up\': !view.collapsed, \'fa-caret-down\': view.collapsed }"></i></button>\n\n            <i class="fa fa-fw fa-file"></i> <span class="cv-gui-title" style="cursor: pointer;" ng-dblclick="studioViewsService.studioScope.showRenameView(view)"><a name="cvView{{ view.id }}"></a>{{ view.params.name }}</span>\n\n            <span ng-if="view.savedId > 0 && reststoreService.isViewChanged(view)" class="badge cv-gui-container-state" style="margin-left: 15px; font-size: 80%;">Modified</span>\n            <span ng-if="view.savedId > 0 && !reststoreService.isViewChanged(view)" class="badge cv-gui-container-state" style="margin-left: 15px; font-size: 80%;">Saved</span>\n            <span ng-if="view.shared" class="badge cv-gui-container-state" style="margin-left: 5px; font-size: 80%;">Shared</span>\n\n            <button type="button" class="btn btn-danger btn-xs" style="visibility: hidden;"><i class="fa fa-fw fa-info"></i></button>\n\n        </div>\n        <div class="panel-body" ng-hide="view.collapsed">\n            <div class="cv-gui-viewcontent">\n\n                <div cv-view-cube view="view"></div>\n\n            </div>\n        </div>\n    </div>\n\n</div>\n'),a.put("studio/rename.html",'  <div class="modal-header">\n    <button type="button" ng-click="close();" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class="modal-title" id="myModalLabel"><i class="fa fa-pencil"></i> Rename view</h4>\n  </div>\n  <div class="modal-body">\n\n        <form class="form" ng-submit="renameView(viewName);">\n            <div class="form-group">\n                <label for="serializedView">Name:</label>\n                <input class="form-control" ng-model="viewName" />\n            </div>\n        </form>\n\n  </div>\n  <div class="modal-footer">\n    <button type="button" ng-click="close();" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n    <button type="button" ng-click="renameView(viewName);" class="btn btn-primary" data-dismiss="modal">Rename</button>\n  </div>\n\n'),a.put("studio/serialize-add.html",'  <div class="modal-header">\n    <button type="button" ng-click="close()" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class="modal-title" id="myModalLabel"><i class="fa fa-code"></i> Add view from serialized JSON</h4>\n  </div>\n  <div class="modal-body">\n\n        <div class="form">\n            <label for="serializedView">Code:</label>\n            <textarea class="form-control" ng-model="serializedView" style="width: 100%; height: 12em;" />\n        </div>\n\n  </div>\n  <div class="modal-footer">\n    <button type="button" ng-click="close()" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n    <button type="button" ng-click="addSerializedView(serializedView)" class="btn btn-primary" data-dismiss="modal">Add View</button>\n  </div>\n\n'),a.put("studio/serialize-view.html",'  <div class="modal-header">\n    <button type="button" ng-click="close()" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class="modal-title" id="myModalLabel"><i class="fa fa-code"></i> Serialized View</h4>\n  </div>\n  <div class="modal-body">\n\n        <div class="form">\n            <label for="serializedView">View definition JSON:</label>\n            <textarea class="form-control cv-serialized-view" ng-bind="serializedView" style="width: 100%; height: 12em;" readonly></textarea>\n        </div>\n\n  </div>\n  <div class="modal-footer">\n    <button type="button" ng-click="close()" class="btn btn-default" data-dismiss="modal">Close</button>\n  </div>\n\n'),a.put("studio/serverinfo.html",'<div class="modal fade" id="cvServerInfo" tabindex="-1" role="dialog" aria-labelledby="">\n  <div class="modal-dialog" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-fw fa-close"></i></span></button>\n        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-database"></i> Server info</h4>\n      </div>\n      <div class="modal-body">\n\n            <p>\n                <i>This CubesViewer version supports Cubes Server version 1.0.x and 1.1.x</i><br />\n                <br />\n                <b>Server version:</b> {{ cubesService.cubesserver.server_version }} <br />\n                <b>Cubes version:</b> {{ cubesService.cubesserver.cubes_version }} <br />\n                <b>API version:</b> {{ cubesService.cubesserver.api_version }} <br />\n            </p>\n            <p>\n                <b>Timezone:</b> {{ cubesService.cubesserver.info.timezone }} <br />\n                <b>Week start:</b> {{ cubesService.cubesserver.info.first_weekday }} <br />\n            </p>\n            <p>\n                <b>Result limit:</b> <strong class="text-warning">{{ cubesService.cubesserver.info.json_record_limit }}</strong> items<br />\n            </p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal"> Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n'),a.put("studio/studio.html",'<div class="cv-bootstrap" ng-controller="CubesViewerStudioController">\n\n    <div class="cv-gui-panel hidden-print">\n\n        <div class="dropdown m-b" style="display: inline-block;">\n          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n            <i class="fa fa-fw fa-cube"></i> Cubes <span class="caret"></span>\n          </button>\n\n          <ul class="dropdown-menu cv-gui-cubeslist-menu">\n\n            <li ng-show="cubesService.state === 1" class="disabled"><a>Loading...</a></li>\n            <li ng-show="cubesService.state === 2 && cubesService.cubesserver._cube_list.length === 0" class="disabled"><a>No cubes found</a></li>\n            <li ng-show="cubesService.state === 3" class="disabled text-danger"><a>Loading failed</a></li>\n\n            <li ng-repeat="cube in cubesService.cubesserver._cube_list | orderBy:\'label\'" ng-click="studioViewsService.addViewCube(cube.name)"><a>{{ cube.label }}</a></li>\n\n          </ul>\n        </div>\n\n\n        <div ng-if="cvOptions.backendUrl" class="dropdown m-b" style="display: inline-block; ">\n          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n            <i class="fa fa-fw fa-file"></i> Saved views <span class="caret"></span>\n          </button>\n\n          <ul class="dropdown-menu cv-gui-catalog-menu">\n\n            <li class="dropdown-header">Personal views</li>\n\n            <!-- <li ng-show="true" class="disabled"><a>Loading...</a></li>  -->\n            <li ng-repeat="sv in reststoreService.savedViews | orderBy:\'sv.name\'" ng-if="sv.owner == cvOptions.user" ng-click="reststoreService.addSavedView(sv.id)"><a style="max-width: 360px; overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="fa fa-fw"></i> {{ sv.name }}</a></li>\n\n            <li class="dropdown-header">Shared by others</li>\n\n            <!-- <li ng-show="true" class="disabled"><a>Loading...</a></li>  -->\n            <li ng-repeat="sv in reststoreService.savedViews | orderBy:\'sv.name\'" ng-if="sv.shared && sv.owner != cvOptions.user" ng-click="reststoreService.addSavedView(sv.id)"><a style="max-width: 360px; overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;"><i class="fa fa-fw"></i> {{ sv.name }}</a></li>\n\n          </ul>\n        </div>\n\n\n        <div class="dropdown m-b" style="display: inline-block; margin-left: 5px;">\n          <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n            <i class="fa fa-fw fa-wrench"></i> Tools <span class="caret"></span>\n          </button>\n\n          <ul class="dropdown-menu">\n\n                <li ng-click="showSerializeAdd()"><a tabindex="0"><i class="fa fa-fw fa-code"></i> Add view from JSON...</a></li>\n\n                <div class="divider"></div>\n\n                <li ng-click="toggleTwoColumn()" ng-class="{ \'hidden-xs\': ! cvOptions.studioTwoColumn, \'disabled\': studioViewsService.views.length == 0 }"><a tabindex="0"><i class="fa fa-fw fa-columns"></i> 2 column\n                    <span class="label label-default" style="margin-left: 10px;" ng-class="{ \'label-success\': cvOptions.studioTwoColumn }">{{ cvOptions.studioTwoColumn ? "ON" : "OFF" }}</span></a>\n                </li>\n                <li ng-click="toggleHideControls()" ng-class="{ \'disabled\': studioViewsService.views.length == 0 }"><a tabindex="0"><i class="fa fa-fw fa-unlock-alt"></i> Hide controls\n                    <span class="label label-default" style="margin-left: 10px;" ng-class="{ \'label-success\': cvOptions.hideControls }">{{ cvOptions.hideControls ? "ON" : "OFF" }}</span></a>\n                </li>\n\n                <div class="divider"></div>\n\n\n                <!-- <li class=""><a data-toggle="modal" data-target="#cvServerInfo"><i class="fa fa-fw fa-server"></i> Data model</a></li> -->\n                <li class="" ng-class="{ \'disabled\': cubesService.state != 2 }"><a data-toggle="modal" data-target="#cvServerInfo" ><i class="fa fa-fw fa-database"></i> Server info</a></li>\n\n                <div class="divider"></div>\n\n                <li class=""><a href="http://github.com/jjmontesl/cubesviewer/blob/master/doc/guide/cubesviewer-user-main.md" target="_blank"><i class="fa fa-fw fa-question"></i> User guide</a></li>\n                <li class=""><a data-toggle="modal" data-target="#cvAboutModal"><i class="fa fa-fw fa-info"></i> About CubesViewer...</a></li>\n\n            </ul>\n        </div>\n\n        <div style="display: inline-block; margin-left: 10px; margin-bottom: 0px;">\n\n             <div class="form-group hidden-xs" style="display: inline-block; margin-bottom: 0px;">\n                <button class="btn" type="button" title="2 column" ng-disabled="studioViewsService.views.length == 0" ng-class="cvOptions.studioTwoColumn ? \'btn-active btn-success\' : \'btn-primary\'" ng-click="toggleTwoColumn()"><i class="fa fa-fw fa-columns"></i></button>\n             </div>\n             <div class="form-group" style="display: inline-block; margin-bottom: 0px;">\n                <button class="btn" type="button" title="Hide controls" ng-disabled="studioViewsService.views.length == 0" ng-class="cvOptions.hideControls ? \'btn-active btn-success\' : \'btn-primary\'" ng-click="toggleHideControls()"><i class="fa fa-fw fa-unlock-alt"></i></button>\n             </div>\n\n        </div>\n\n        <div class="cv-gui-modals">\n            <div ng-include="\'studio/about.html\'"></div>\n            <div ng-include="\'studio/serverinfo.html\'"></div>\n        </div>\n\n    </div>\n\n    <div class="cv-gui-workspace">\n\n        <div class="row">\n            <div ng-if="cubesService.state == 3" class="col-xs-12" style="margin-bottom: 10px;">\n                <div class="alert alert-danger" style="margin: 0px;">\n                    <p>Could not connect to server: {{ cubesService.stateText }}</p>\n                    <p>Please try again and contact your administrator if the problem persists.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class="row cv-views-container" data-masonry=\'{ "itemSelector": ".cv-view-container", "columnWidth": ".cv-views-gridsizer", "percentPosition": true }\'>\n\n            <div class="col-xs-1 cv-views-gridsizer"></div>\n\n            <div ng-repeat="studioView in studioViewsService.views" style="display: none;" class="col-xs-12 cv-view-container sv{{ studioView.id }}" ng-class="(cvOptions.studioTwoColumn ? \'col-sm-6\' : \'col-sm-12\')">\n                <div >\n                    <div cv-studio-view view="studioView"></div>\n                </div>\n            </div>\n\n        </div>\n\n    </div>\n\n</div>\n\n\n'),
a.put("views/cube/alerts.html",'<div>\n\n    <div ng-if="view.requestFailed" class="alert alert-dismissable alert-danger" style="margin-bottom: 5px;">\n        <div style="display: inline-block;"><i class="fa fa-exclamation"></i></div>\n        <div style="display: inline-block; margin-left: 20px;">\n            An error has occurred. Cannot present view.<br />\n            Please try again and contact your administrator if the problem persists.\n        </div>\n    </div>\n\n    <div ng-if="view.resultLimitHit" class="alert alert-dismissable alert-warning" style="margin-bottom: 5px;">\n        <button type="button" class="close" ng-click="view._resultLimitHit = false;" data-dismiss="alert" aria-hidden="true">&times;</button>\n        <div style="display: inline-block; vertical-align: top;"><i class="fa fa-exclamation"></i></div>\n        <div style="display: inline-block; margin-left: 20px;">\n            Limit of {{ cubesService.cubesserver.info.json_record_limit }} items has been hit. <b>Results are incomplete.</b><br />\n            <i>Tip</i>: reduce level of drilldown or filter your selection to reduce the number of items in the result.\n        </div>\n    </div>\n\n</div>\n'),a.put("views/cube/chart/chart-common.html",'<div ng-show="(view.grid.data.length > 0 && view.params.yaxis != null) && (!(view.params.charttype == \'pie\' && view.grid.columnDefs.length > 2)) && (!(view.params.charttype == \'radar\' && view.grid.columnDefs.length < 4))" style="width: 99%;">\n    <div>\n        <div class="cv-chart-container">\n            <svg style="height: 400px;" />\n        </div>\n        <div ng-hide="view.getControlsHidden() || view.params.charttype == \'radar\'" style="font-size: 8px; float: right;">\n            <a href="" class="cv-chart-height" ng-click="chartCtrl.resizeChart(400);">Small</a>\n            <a href="" class="cv-chart-height" ng-click="chartCtrl.resizeChart(550);">Medium</a>\n            <a href="" class="cv-chart-height" ng-click="chartCtrl.resizeChart(700);">Tall</a>\n        </div>\n    </div>\n</div>\n\n<div ng-if="view.params.yaxis == null" class="alert alert-info" style="margin-bottom: 0px;">\n    <p>\n        Cannot present chart: no <b>measure</b> has been selected.\n    </p>\n    <p>\n        Tip: use the <kbd><i class="fa fa-fw fa-cogs"></i> View &gt; <i class="fa fa-fw fa-crosshairs"></i> Measure</kbd> menu.\n    </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.grid.data.length == 0" class="alert alert-info" style="margin-bottom: 0px;">\n    <p>\n        Cannot present chart: <b>no rows returned</b> by the current filtering, horizontal dimension, and drilldown combination.\n    </p>\n    <p>\n        Tip: use the <kbd><i class="fa fa-fw fa-cogs"></i> View</kbd> menu to select an horizontal dimension.\n    </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.charttype == \'pie\' && view.grid.columnDefs.length > 2" class="alert alert-info" style="margin-bottom: 0px;">\n    <p>\n        Cannot present a <b>pie chart</b> when <b>more than one column</b> is present.<br />\n    </p>\n    <p>\n        Tip: review chart data and columns in <a href="" ng-click="setViewMode(\'series\')" class="alert-link">series mode</a>,\n        or <a href="" ng-click="selectXAxis(null);" class="alert-link">remove horizontal dimension</a>.\n    </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.params.charttype == \'radar\' && view.grid.columnDefs.length < 4" class="alert alert-info" style="margin-bottom: 0px;">\n    Cannot present a <b>radar chart</b> when <b>less than 3 columns</b> are present.<br />\n    Tip: review chart data and columns in <a href="" ng-click="setViewMode(\'series\')" class="alert-link">series mode</a>.\n</div>\n'),a.put("views/cube/chart/chart.html",'<div ng-controller="CubesViewerViewsCubeChartController as chartCtrl">\n\n    <div ng-if="view.params.charttype == \'pie\'">\n        <h3><i class="fa fa-fw fa-pie-chart"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartPieController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'bars-vertical\'">\n        <h3><i class="fa fa-fw fa-bar-chart"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartBarsVerticalController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'bars-horizontal\'">\n        <h3><i class="fa fa-fw fa-bar-chart fa-rotate-270"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartBarsHorizontalController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'lines\'">\n        <h3><i class="fa fa-fw fa-line-chart"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartLinesController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'lines-stacked\'">\n        <h3><i class="fa fa-fw fa-area-chart"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartLinesController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'radar\'">\n        <h3><i class="fa fa-fw fa-bullseye"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartRadarController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'sunburst\'">\n        <h3><i class="fa fa-fw fa-sun-o"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n            <span class="loadingbar-expand"></span>\n        </div>\n        <div ng-controller="CubesViewerViewsCubeChartSunburstController">\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n</div>\n'),a.put("views/cube/cube-menu-drilldown.html",'  <button class="btn btn-primary btn-sm dropdown-toggle drilldownbutton" ng-disabled="view.params.mode == \'facts\'" type="button" data-toggle="dropdown" data-submenu>\n    <i class="fa fa-fw fa-arrow-down"></i> <span class="hidden-xs" ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Drilldown</span> <span class="caret"></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu-drilldown">\n\n      <!-- if ((grayout_drill) && ((($.grep(view.params.drilldown, function(ed) { return ed == dimension.name; })).length > 0))) { -->\n      <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click="selectDrill(dimension.name, true);">\n        <a href="">{{ dimension.label }}</a>\n      </li>\n      <li ng-repeat-end ng-if="dimension.levels.length != 1" class="dropdown-submenu">\n        <a tabindex="0">{{ dimension.label }}</a>\n\n        <ul ng-if="dimension.hierarchies_count() != 1" class="dropdown-menu">\n            <li ng-repeat="(hikey,hi) in dimension.hierarchies" class="dropdown-submenu">\n                <a tabindex="0" href="" onclick="return false;">{{ hi.label }}</a>\n                <ul class="dropdown-menu">\n                    <li ng-repeat="level in hi.levels" ng-click="selectDrill(dimension.name + \'@\' + hi.name + \':\' + level.name, true)"><a href="">{{ level.label }}</a></li>\n                </ul>\n            </li>\n        </ul>\n\n        <ul ng-if="dimension.hierarchies_count() == 1" class="dropdown-menu">\n            <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="selectDrill(dimension.name + \'@\' + dimension.default_hierarchy().name + \':\' + level.name, true)"><a href="">{{ level.label }}</a></li>\n        </ul>\n\n      </li>\n\n      <div class="divider"></div>\n\n      <li ng-class="{ \'disabled\': view.params.drilldown.length == 0 }" ng-click="selectDrill(\'\')"><a href=""><i class="fa fa-fw fa-close"></i> None</a></li>\n\n  </ul>\n\n'),a.put("views/cube/cube-menu-filter.html",'  <button class="btn btn-primary btn-sm dropdown-toggle cutbutton" type="button" data-toggle="dropdown" data-submenu>\n    <i class="fa fa-fw fa-filter"></i> <span class="hidden-xs" ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Filter</span> <span class="caret"></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-cut">\n\n    <li ng-show="view.params.mode == \'explore\'" ng-click="filterSelected()" ng-class="{ \'disabled\': view.params.drilldown.length != 1 }"><a href=""><i class="fa fa-fw fa-filter"></i> Filter selected rows</a></li>\n    <div ng-show="view.params.mode == \'explore\'" class="divider"></div>\n\n    <li class="dropdown-submenu">\n        <a tabindex="0"><i class="fa fa-fw fa-bars"></i> Dimension filter</a>\n        <ul class="dropdown-menu">\n\n          <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click="showDimensionFilter(dimension.name);">\n            <a href="">{{ dimension.label }}</a>\n          </li>\n          <li ng-repeat-end ng-if="dimension.levels.length != 1" class="dropdown-submenu">\n            <a tabindex="0">{{ dimension.label }}</a>\n\n            <ul ng-if="dimension.hierarchies_count() != 1" class="dropdown-menu">\n                <li ng-repeat="(hikey,hi) in dimension.hierarchies" class="dropdown-submenu">\n                    <a tabindex="0" href="" onclick="return false;">{{ hi.label }}</a>\n                    <ul class="dropdown-menu">\n                        <!-- ng-click="selectDrill(dimension.name + \'@\' + hi.name + \':\' + level.name, true)"  -->\n                        <li ng-repeat="level in hi.levels" ng-click="showDimensionFilter(dimension.name + \'@\' + hi.name + \':\' + level.name )"><a href="">{{ level.label }}</a></li>\n                    </ul>\n                </li>\n            </ul>\n\n            <ul ng-if="dimension.hierarchies_count() == 1" class="dropdown-menu">\n                <!--  selectDrill(dimension.name + \':\' + level.name, true) -->\n                <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="showDimensionFilter(dimension.name + \'@\' + dimension.default_hierarchy().name + \':\' + level.name);"><a href="">{{ level.label }}</a></li>\n            </ul>\n\n          </li>\n\n        </ul>\n    </li>\n\n    <li class="dropdown-submenu">\n        <a tabindex="0"><i class="fa fa-fw fa-calendar"></i> Date filter</a>\n        <ul class="dropdown-menu">\n          <li ng-repeat="dimension in view.cube.dimensions" ng-if="dimension.isDateDimension()">\n            <a href="" ng-click="selectDateFilter(dimension.name + ((dimension.info[\'cv-datefilter-hierarchy\']) ? \'@\' + dimension.info[\'cv-datefilter-hierarchy\'] : \'\'), true)">\n                {{ dimension.label + ((dimension.hierarchy(dimension.info["cv-datefilter-hierarchy"])) ? " / " + dimension.hierarchy(dimension.info["cv-datefilter-hierarchy"]).label : "") }}\n            </a>\n          </li>\n          <li ng-if="view.cube.dateDimensions().length == 0" class="disabled">\n            <a href="" ng-click=""><i>No date filters defined for this cube.</i></a>\n          </li>\n\n        </ul>\n    </li>\n\n    <!--\n    <li class="dropdown-submenu">\n        <a tabindex="0"><i class="fa fa-fw fa-arrows-h"></i> Range filter</a>\n        <ul class="dropdown-menu">\n\n          <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click="showDimensionFilter(dimension.name);">\n            <a href="">{{ dimension.label }}</a>\n          </li>\n          <li ng-repeat-end ng-if="dimension.levels.length != 1" class="dropdown-submenu">\n            <a tabindex="0">{{ dimension.label }}</a>\n\n            <ul ng-if="dimension.hierarchies_count() != 1" class="dropdown-menu">\n                <li ng-repeat="(hikey,hi) in dimension.hierarchies" class="dropdown-submenu">\n                    <a tabindex="0" href="" onclick="return false;">{{ hi.label }}</a>\n                    <ul class="dropdown-menu">\n                        <li ng-repeat="level in hi.levels" ng-click="showDimensionFilter(dimension.name + \'@\' + hi.name + \':\' + level.name )"><a href="">{{ level.label }}</a></li>\n                    </ul>\n                </li>\n            </ul>\n\n            <ul ng-if="dimension.hierarchies_count() == 1" class="dropdown-menu">\n                <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="showDimensionFilter(level);"><a href="">{{ level.label }}</a></li>\n            </ul>\n\n          </li>\n\n        </ul>\n    </li>\n     -->\n\n    <div class="divider"></div>\n\n    <li ng-class="{ \'disabled\': view.params.cuts.length == 0 && view.params.datefilters.length == 0 }" ng-click="clearFilters()"><a href=""><i class="fa fa-fw fa-trash"></i> Clear filters</a></li>\n\n  </ul>\n'),a.put("views/cube/cube-menu-panel.html",'  <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n    <i class="fa fa-fw fa-file"></i> <span class="hidden-xs" ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Panel</span> <span class="caret"></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-view">\n\n    <li ng-click="viewsService.studioViewsService.studioScope.showRenameView(view)"><a><i class="fa fa-fw fa-pencil"></i> Rename...</a></li>\n    <li ng-click="viewsService.studioViewsService.studioScope.cloneView(view)"><a><i class="fa fa-fw fa-clone"></i> Clone</a></li>\n\n    <div ng-if="cvOptions.backendUrl" class="divider"></div>\n    <li ng-if="cvOptions.backendUrl" ng-click="reststoreService.saveView(view)"><a><i class="fa fa-fw fa-save"></i> Save</a></li>\n    <li ng-if="cvOptions.backendUrl" ng-click="reststoreService.shareView(view, ! view.shared)"><a><i class="fa fa-fw fa-share"></i> {{ view.shared ? "Unshare" : "Share" }}</a></li>\n    <li ng-if="cvOptions.backendUrl" ng-click="reststoreService.deleteView(view)"><a><i class="fa fa-fw fa-trash-o"></i> Delete...</a></li>\n\n    <div class="divider"></div>\n    <li ng-click="viewsService.studioViewsService.studioScope.showSerializeView(view)"><a><i class="fa fa-fw fa-code"></i> Serialize...</a></li>\n    <div class="divider"></div>\n    <li ng-click="viewsService.studioViewsService.closeView(view)"><a><i class="fa fa-fw fa-close"></i> Close</a></li>\n  </ul>\n'),a.put("views/cube/cube-menu-view.html",'  <button class="btn btn-primary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n    <i class="fa fa-fw fa-cogs"></i> <span class="hidden-xs" ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">View</span> <span class="caret"></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-view">\n\n    <li ng-show="view.params.mode == \'chart\'" class="dropdown-submenu">\n        <a tabindex="0" ><i class="fa fa-fw fa-area-chart"></i> Chart type</a>\n        <ul class="dropdown-menu">\n          <li ng-click="selectChartType(\'pie\')"><a href=""><i class="fa fa-fw fa-pie-chart"></i> Pie</a></li>\n          <li ng-click="selectChartType(\'bars-vertical\')"><a href=""><i class="fa fa-fw fa-bar-chart"></i> Bars Vertical</a></li>\n          <li ng-click="selectChartType(\'bars-horizontal\')"><a href=""><i class="fa fa-fw fa-rotate-270 fa-bar-chart"></i> Bars Horizontal</a></li>\n          <li ng-click="selectChartType(\'lines\')"><a href=""><i class="fa fa-fw fa-line-chart"></i> Lines</a></li>\n          <li ng-click="selectChartType(\'lines-stacked\')"><a href=""><i class="fa fa-fw fa-area-chart"></i> Areas</a></li>\n          <li ng-click="selectChartType(\'radar\')"><a href=""><i class="fa fa-fw fa-bullseye"></i> Radar</a></li>\n\n          <!-- <div class="divider"></div>  -->\n\n          <!--\n          <li><a href=""><i class="fa fa-fw fa-dot-circle-o"></i> Bubbles</a></li>\n          <li><a href=""><i class="fa fa-fw fa-square"></i> Treemap</a></li>\n          <li ng-click="selectChartType(\'sunburst\')"><a href=""><i class="fa fa-fw fa-sun-o"></i> Sunburst</a></li>\n          -->\n\n          <!--\n          <div class="divider"></div>\n\n          <li><a href=""><i class="fa fa-fw fa-globe"></i> Map</a></li>\n           -->\n\n        </ul>\n    </li>\n\n    <!--\n    <li ng-show="view.params.mode == \'chart\' && (view.params.charttype == \'lines-stacked\' || view.params.charttype == \'lines\' || view.params.charttype == \'bars-horizontal\')" class="dropdown-submenu">\n        <a tabindex="0" ><i class="fa fa-fw fa-sliders"></i> Chart options</a>\n        <ul class="dropdown-menu">\n    -->\n        <li class="dropdown-submenu" ng-show="view.params.mode == \'chart\' && (view.params.charttype == \'lines-stacked\' || view.params.charttype == \'lines\')">\n            <a href=""><i class="fa fa-fw fa-angle-up"></i> Curve type</a>\n            <ul class="dropdown-menu">\n                <li ng-class="{\'active\': view.params.chartoptions.lineInterpolation == \'linear\'}" ng-click="view.params.chartoptions.lineInterpolation = \'linear\'; refreshView();"><a href=""> Linear</a></li>\n                <li ng-class="{\'active\': view.params.chartoptions.lineInterpolation == \'monotone\'}" ng-click="view.params.chartoptions.lineInterpolation = \'monotone\'; refreshView();"><a href=""> Smooth</a></li>\n                <!-- <li ng-class="{\'active\': view.params.chartoptions.lineInterpolation == \'cardinal\'}" ng-click="view.params.chartoptions.lineInterpolation = \'cardinal\'; refreshView();"><a href=""> Smooth (Cardinal)</a></li>  -->\n            </ul>\n        </li>\n\n        <li ng-class="{\'disabled\': view.grid.data.length != 2 }" ng-show="view.params.mode == \'chart\' && view.params.charttype == \'bars-horizontal\'" ng-click="view.params.chartoptions.mirrorSerie2 = !view.params.chartoptions.mirrorSerie2; refreshView();">\n            <a><i class="fa fa-fw fa-arrows-h"></i> Invert 2nd series\n                <span style="margin-left: 5px;" class="label label-default" ng-class="{ \'label-success\': view.params.chartoptions.mirrorSerie2 }">{{ view.params.chartoptions.mirrorSerie2 ? "ON" : "OFF" }}</span>\n            </a>\n        </li>\n\n    <!--\n        </ul>\n    </li>\n     -->\n\n    <li ng-show="view.params.mode == \'chart\'" ng-click="view.params.chartoptions.showLegend = !view.params.chartoptions.showLegend; refreshView();">\n        <a><i class="fa fa-fw" ng-class="{\'fa-toggle-on\': view.params.chartoptions.showLegend, \'fa-toggle-off\': ! view.params.chartoptions.showLegend }"></i> Toggle legend\n            <span style="margin-left: 5px;" class="label label-default" ng-class="{ \'label-success\': view.params.chartoptions.showLegend }">{{ view.params.chartoptions.showLegend ? "ON" : "OFF" }}</span>\n        </a>\n    </li>\n\n    <div ng-show="view.params.mode == \'chart\'" class="divider"></div>\n\n    <li ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="dropdown-submenu">\n        <a tabindex="0"><i class="fa fa-fw fa-long-arrow-right"></i> Horizontal dimension</a>\n        <ul class="dropdown-menu">\n\n          <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click="selectXAxis(dimension.name)">\n            <a href="">{{ dimension.label }}</a>\n          </li>\n          <li ng-repeat-end ng-if="dimension.levels.length != 1" class="dropdown-submenu">\n            <a tabindex="0">{{ dimension.label }}</a>\n\n            <ul ng-if="dimension.hierarchies_count() != 1" class="dropdown-menu">\n                <li ng-repeat="(hikey,hi) in dimension.hierarchies" class="dropdown-submenu">\n                    <a tabindex="0" href="" onclick="return false;">{{ hi.label }}</a>\n                    <ul class="dropdown-menu">\n                        <!-- ng-click="selectDrill(dimension.name + \'@\' + hi.name + \':\' + level.name, true)"  -->\n                        <li ng-repeat="level in hi.levels" ng-click="selectXAxis(dimension.name + \'@\' + hi.name + \':\' + level.name )"><a href="">{{ level.label }}</a></li>\n                    </ul>\n                </li>\n            </ul>\n\n            <ul ng-if="dimension.hierarchies_count() == 1" class="dropdown-menu">\n                <!--  selectDrill(dimension.name + \':\' + level.name, true) -->\n                <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="selectXAxis(dimension.name + \':\' + level.name);"><a href="">{{ level.label }}</a></li>\n            </ul>\n\n          </li>\n\n          <div class="divider"></div>\n\n          <li ng-click="selectXAxis(null);"><a href=""><i class="fa fa-fw fa-close"></i> None</a></li>\n\n        </ul>\n    </li>\n\n    <li ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="dropdown-submenu">\n        <a tabindex="0"><i class="fa fa-fw fa-crosshairs"></i> Measure</a>\n        <ul class="dropdown-menu">\n\n          <li ng-repeat="measure in view.cube.measures" ng-if="view.cube.measureAggregates(measure.name).length > 0" class="dropdown-submenu">\n            <a href="">{{ measure.label }}</a>\n            <ul class="dropdown-menu">\n                <li ng-repeat="aggregate in view.cube.measureAggregates(measure.name)" >\n                    <a href="" ng-click="selectMeasure(aggregate.ref)">{{ aggregate.label }}</a>\n                </li>\n            </ul>\n          </li>\n\n          <div class="divider" ng-if="view.cube.measureAggregates(null).length > 0"></div>\n          <li ng-repeat="aggregate in view.cube.measureAggregates(null)" ng-if="view.cube.measureAggregates(null).length > 0" >\n            <a href="" ng-click="selectMeasure(aggregate.ref)">{{ aggregate.label }}</a>\n          </li>\n\n        </ul>\n    </li>\n\n    <div ng-show="cvOptions.seriesOperationsEnabled && (view.params.mode == \'series\' || view.params.mode == \'chart\')" class="divider"></div>\n\n    <li ng-show="cvOptions.seriesOperationsEnabled && (view.params.mode == \'series\' || view.params.mode == \'chart\')" class="dropdown-submenu">\n        <a tabindex="0" ><i class="fa fa-fw fa-calculator"></i> Series operations</a>\n        <ul class="dropdown-menu">\n          <li ng-click="selectOperation(\'difference\')"><a href=""><i class="fa fa-fw fa-line-chart"></i> Difference</a></li>\n          <li ng-click="selectOperation(\'percentage\')"><a href=""><i class="fa fa-fw fa-percent"></i> Change rate</a></li>\n          <!--\n          <li ng-click="selectOperation(\'accum\')"><a href=""><i class="fa fa-fw">&sum;</i> Accumulated</a></li>\n          <div class="divider"></div>\n          <li ng-click="selectOperation(\'fill-zeros\')"><a href=""><i class="fa fa-fw">0</i> Replace blanks with zeroes</a></li>\n           -->\n          <div class="divider"></div>\n          <li ng-click="selectOperation(null)"><a href=""><i class="fa fa-fw fa-times"></i> Clear operations</a></li>\n        </ul>\n    </li>\n\n    <div ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="divider"></div>\n\n    <li ng-show="view.params.mode != \'chart\'" ng-click="exportService.exportGridAsCsv(view)"><a><i class="fa fa-fw fa-table"></i> Export table</a></li>\n    <li ng-show="view.params.mode == \'chart\' && view.params.charttype != \'radar\' " ng-click="view.exportChartAsPNG()"><a><i class="fa fa-fw fa-picture-o"></i> Export figure</a></li>\n    <li ng-click="exportService.exportFacts(view)"><a><i class="fa fa-fw fa-th"></i> Export facts</a></li>\n\n  </ul>\n\n'),a.put("views/cube/cube.html",'<div class="cv-view-panel" ng-controller="CubesViewerViewsCubeController as cubeView" >\n\n    <div ng-if="view.state == 3">\n        <div class="alert alert-danger" style="margin: 0px;">\n            <p>An error occurred. Cannot present view.</p>\n            <p ng-if="cubesService.state != 3">{{ view.error }}</p>\n            <p ng-if="cubesService.state == 3">Could not connect to data server: {{ cubesService.stateText }}</p>\n            <p>Please try again and contact your administrator if the problem persists.</p>\n            <p class="text-right">\n                <a class="alert-link" href="http://jjmontesl.github.io/cubesviewer/" target="_blank">CubesViewer Data Visualizer</a>\n            </p>\n        </div>\n    </div>\n\n    <div>\n        <h2 ng-show="view.getControlsHidden()" style="margin-top: 5px;">\n            <i class="fa fa-fw fa-file-o"></i> {{ view.params.name }}\n        </h2>\n\n        <div ng-include="\'views/cube/alerts.html\'"></div>\n    </div>\n\n    <div ng-if="view.state == 2" style="min-height: 80px;">\n\n        <div class="cv-view-viewmenu hidden-print" ng-hide="view.getControlsHidden()">\n\n            <div class="panel panel-primary pull-right" style="padding: 3px; white-space: nowrap; margin-bottom: 6px; margin-left: 6px;">\n\n                <div ng-if="cvOptions.undoEnabled" class="btn-group" role="group" ng-controller="CubesViewerViewsUndoController">\n                  <button type="button" ng-click="undo()" ng-disabled="view.undoPos <= 0" class="btn btn-default btn-sm" title="Undo"><i class="fa fa-fw fa-undo"></i></button>\n                  <button type="button" ng-click="redo()" ng-disabled="view.undoPos >= view.undoList.length - 1" class="btn btn-default btn-sm" title="Redo"><i class="fa fa-fw fa-undo fa-flip-horizontal"></i></button>\n                </div>\n\n                <div class="btn-group" role="group" aria-label="..." style="margin-left: 5px;">\n                  <button type="button" ng-click="setViewMode(\'explore\')" ng-class="{\'active\': view.params.mode == \'explore\'}" class="btn btn-primary btn-sm explorebutton" title="Explore"><i class="fa fa-fw fa-arrow-circle-down"></i></button>\n                  <button type="button" ng-click="setViewMode(\'facts\')" ng-class="{\'active\': view.params.mode == \'facts\'}" class="btn btn-primary btn-sm " title="Facts"><i class="fa fa-fw fa-th"></i></button>\n                  <button type="button" ng-click="setViewMode(\'series\')" ng-class="{\'active\': view.params.mode == \'series\'}" class="btn btn-primary btn-sm " title="Series"><i class="fa fa-fw fa-clock-o"></i></button>\n                  <button type="button" ng-click="setViewMode(\'chart\')" ng-class="{\'active\': view.params.mode == \'chart\'}" class="btn btn-primary btn-sm " title="Charts"><i class="fa fa-fw fa-area-chart"></i></button>\n                </div>\n\n                <div ng-include="\'views/cube/cube-menu-drilldown.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px;"></div>\n\n                <div ng-include="\'views/cube/cube-menu-filter.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 2px;"></div>\n\n                <div ng-include="\'views/cube/cube-menu-view.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px;"></div>\n\n                <div ng-if="cvOptions.container" ng-include="\'views/cube/cube-menu-panel.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px;"></div>\n\n            </div>\n\n            <div class="pull-right" style="white-space: nowrap; padding-top: 4px; padding-bottom: 4px; margin-left: 6px; margin-bottom: 6px;">\n\n            </div>\n\n        </div>\n\n        <div class="cv-view-viewinfo">\n            <div>\n                <div class="label label-secondary cv-infopiece cv-view-viewinfo-cubename" style="color: white; background-color: black;">\n                    <span><i class="fa fa-fw fa-cube" title="Cube"></i> <b class="hidden-xs hidden-sm">Cube:</b> {{ view.cube.label }}</span>\n                    <button type="button" class="btn btn-info btn-xs" style="visibility: hidden;"><i class="fa fa-fw fa-info"></i></button>\n                </div>\n\n                <div class="cv-view-viewinfo-drill">\n\n\n                    <div ng-repeat="drilldown in view.params.drilldown" ng-init="parts = view.cube.dimensionParts(drilldown);" ng-if="view.params.mode != \'facts\'" class="label label-secondary cv-infopiece cv-view-viewinfo-drill" style="color: black; background-color: #ccffcc;">\n                        <span><i class="fa fa-fw fa-arrow-down" title="Drilldown"></i> <b class="hidden-xs hidden-sm">Drilldown:</b> <span title="{{ view.cube.dimensionParts(drilldown).label }}">{{ parts.labelShort }}</span></span>\n                        <button type="button" class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px;"><i class="fa fa-fw fa-info"></i></button>\n\n                        <button ng-hide="view.getControlsHidden() || parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionMinus" type="button" ng-click="selectDrill(parts.drilldownDimensionMinus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px;"><i class="fa fa-fw fa-minus"></i></button>\n                        <button ng-hide="view.getControlsHidden() || parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionPlus" type="button" ng-click="selectDrill(parts.drilldownDimensionPlus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 0px;"><i class="fa fa-fw fa-plus"></i></button>\n\n                        <button ng-hide="view.getControlsHidden()" type="button" ng-click="showDimensionFilter(drilldown)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px;"><i class="fa fa-fw fa-search"></i></button>\n                        <button ng-hide="view.getControlsHidden()" type="button" ng-click="selectDrill(drilldown, \'\')" class="btn btn-danger btn-xs hidden-print" style="margin-left: 1px;"><i class="fa fa-fw fa-trash"></i></button>\n                    </div>\n\n                </div>\n                <div class="cv-view-viewinfo-cut">\n                    <!--\n                        var dimensionString = $(this).parents(\'.cv-view-infopiece-cut\').first().attr(\'data-dimension\');\n                        var parts = view.cube.dimensionParts(dimensionString);\n                        var depth = $(this).parents(\'.cv-view-infopiece-cut\').first().attr(\'data-value\').split(\';\')[0].split(",").length;\n                        cubesviewer.views.cube.dimensionfilter.drawDimensionFilter(view, dimensionString + ":" + parts.hierarchy.levels[depth - 1] );\n                     -->\n                    <div ng-repeat="cut in view.params.cuts" ng-init="equality = cut.invert ? \' &ne; \' : \' = \';" class="label label-secondary cv-infopiece cv-view-viewinfo-cut" style="color: black; background-color: #ffcccc;">\n                        <span style="max-width: 480px;"><i class="fa fa-fw fa-filter" title="Filter"></i> <b class="hidden-xs hidden-sm">Filter:</b> <span title="{{ view.cube.dimensionPartsFromCut(cut).label }}">{{ view.cube.dimensionPartsFromCut(cut).labelShort }}</span> <span ng-class="{ \'text-danger\': cut.invert }">{{ equality }}</span> <span title="{{ cut.value }}">{{ cut.value }}</span></span>\n                        <button type="button" class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px;"><i class="fa fa-fw fa-info"></i></button>\n                        <button ng-hide="view.getControlsHidden()" type="button" ng-click="showDimensionFilter(view.cube.dimensionPartsFromCut(cut).drilldownDimension)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px;"><i class="fa fa-fw fa-search"></i></button>\n                        <button ng-hide="view.getControlsHidden()" type="button" ng-click="selectCut(cut.dimension, \'\', cut.invert)" class="btn btn-danger btn-xs hidden-print" style="margin-left: 1px;"><i class="fa fa-fw fa-trash"></i></button>\n                    </div>\n                </div>\n\n                <div ng-include="\'views/cube/filter/datefilter.html\'"></div>\n\n                <div class="cv-view-viewinfo-extra">\n\n                    <div ng-if="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="label label-secondary cv-infopiece cv-view-viewinfo-extra" style="color: black; background-color: #ccccff;">\n                        <span style="max-width: 350px;"><i class="fa fa-fw fa-crosshairs" title="Measure"></i> <b class="hidden-xs hidden-sm">Measure:</b> {{ (view.params.yaxis != null) ? view.cube.aggregateFromName(view.params.yaxis).label : "None" }}</span>\n                        <button type="button" class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px;"><i class="fa fa-fw fa-info"></i></button>\n                    </div>\n\n                    <div ng-if="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="label label-secondary cv-infopiece cv-view-viewinfo-extra" style="color: black; background-color: #ccddff;">\n                        <span style="max-width: 350px;"><i class="fa fa-fw fa-long-arrow-right" title="Horizontal dimension"></i> <b class="hidden-xs hidden-sm">Horizontal dimension:</b> {{ (view.params.xaxis != null) ? view.cube.dimensionParts(view.params.xaxis).labelShort : "None" }}</span>\n                        <button type="button" class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px;"><i class="fa fa-fw fa-info"></i></button>\n\n                        <button ng-hide="view.getControlsHidden() || !view.params.xaxis || view.cube.dimensionParts(view.params.xaxis).hierarchy.levels.length < 2" ng-disabled="! view.cube.dimensionParts(view.params.xaxis).drilldownDimensionMinus" type="button" ng-click="selectXAxis(view.cube.dimensionParts(view.params.xaxis).drilldownDimensionMinus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px;"><i class="fa fa-fw fa-minus"></i></button>\n                        <button ng-hide="view.getControlsHidden() || !view.params.xaxis || view.cube.dimensionParts(view.params.xaxis).hierarchy.levels.length < 2" ng-disabled="! view.cube.dimensionParts(view.params.xaxis).drilldownDimensionPlus" type="button" ng-click="selectXAxis(view.cube.dimensionParts(view.params.xaxis).drilldownDimensionPlus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 0px;"><i class="fa fa-fw fa-plus"></i></button>\n\n                        <!-- <button type="button" ng-click="showDimensionFilter(view.params.xaxis)" class="btn btn-secondary btn-xs" style="margin-left: 3px;"><i class="fa fa-fw fa-search"></i></button>  -->\n                        <!-- <button type="button" ng-click="selectXAxis(null)" class="btn btn-danger btn-xs" style="margin-left: 1px;"><i class="fa fa-fw fa-trash"></i></button>  -->\n                    </div>\n\n                </div>\n            </div>\n        </div>\n        <div class="clearfix"></div>\n\n        <div class="cv-view-viewdialogs">\n            <div ng-if="view.dimensionFilter" ng-include="\'views/cube/filter/dimension.html\'"></div>\n        </div>\n\n        <div class="cv-view-viewdata">\n\n            <div ng-if="view.params.mode == \'explore\'" ng-include="\'views/cube/explore/explore.html\'"></div>\n            <div ng-if="view.params.mode == \'facts\'" ng-include="\'views/cube/facts/facts.html\'"></div>\n            <div ng-if="view.params.mode == \'series\'" ng-include="\'views/cube/series/series.html\'"></div>\n            <div ng-if="view.params.mode == \'chart\'" ng-include="\'views/cube/chart/chart.html\'"></div>\n\n        </div>\n        <div class="clearfix"></div>\n\n        <div class="cv-view-viewfooter"></div>\n\n    </div>\n\n</div>\n'),
a.put("views/cube/explore/explore.html",'<div ng-controller="CubesViewerViewsCubeExploreController">\n\n    <!-- ($(view.container).find(\'.cv-view-viewdata\').children().size() == 0)  -->\n    <h3><i class="fa fa-fw fa-arrow-circle-down"></i> Aggregated data\n        <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n    </h3>\n\n    <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n        <span class="loadingbar-expand"></span>\n    </div>\n\n    <div ui-grid="view.grid"\n         ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize\n         ui-grid-pagination ui-grid-pinning\n         style="width: 100%;" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 30 + \'px\'}">\n    </div>\n    <div style="height: 30px;">&nbsp;</div>\n\n</div>\n'),a.put("views/cube/facts/facts.html",'<div ng-controller="CubesViewerViewsCubeFactsController">\n\n    <!-- ($(view.container).find(\'.cv-view-viewdata\').children().size() == 0)  -->\n    <h3><i class="fa fa-fw fa-th"></i> Facts data\n        <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n    </h3>\n\n    <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n        <span class="loadingbar-expand"></span>\n    </div>\n\n    <div ng-if="view.grid.data.length > 0"\n         ui-grid="view.grid"\n         ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize\n         ui-grid-pagination ui-grid-pinning\n         style="width: 100%;" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 30 + \'px\'}">\n    </div>\n    <div ng-if="view.grid.data.length > 0" style="height: 30px;">&nbsp;</div>\n\n    <div ng-if="viewController.view.pendingRequests == 0 && view.grid.data.length == 0">No facts are returned by the current filtering combination.</div>\n\n</div>\n'),a.put("views/cube/filter/datefilter.html",'<div class="cv-view-viewinfo-date">\n    <div ng-repeat="datefilter in view.params.datefilters" ng-controller="CubesViewerViewsCubeFilterDateController" ng-init="dimparts = view.cube.dimensionParts(datefilter.dimension);" class="label label-secondary cv-infopiece cv-view-viewinfo-cut text-left" style="color: black; background-color: #ffdddd; text-align: left;">\n        <span style="max-width: 280px; white-space: nowrap;"><i class="fa fa-fw fa-filter"></i> <b class="hidden-xs hidden-sm">Filter:</b> {{ dimparts.labelNoLevel }}:</span>\n\n        <!--\n        <br class="hidden-sm hidden-md hidden-lg" />\n        <i class="fa fa-fw hidden-sm hidden-md hidden-lg" />\n         -->\n\n        <div class="cv-datefilter" style="overflow: visible; display: inline-block;">\n\n            <form class="form-inline">\n\n                 <div class="form-group" style="display: inline-block; margin: 0px;">\n                    <div class="dropdown" style="display: inline-block;">\n                      <button ng-hide="view.getControlsHidden()" style="height: 20px;" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" data-submenu>\n                        <i class="fa fa-fw fa-calendar"></i> {{ datefilter.mode | datefilterMode }} <span class="caret"></span>\n                      </button>\n                      <span ng-show="view.getControlsHidden()"><i class="fa fa-fw fa-calendar"></i> {{ datefilter.mode | datefilterMode }}</span>\n\n                      <ul class="dropdown-menu cv-view-menu cv-view-menu-view">\n                        <li ng-click="setMode(\'custom\')"><a><i class="fa fa-fw"></i> Custom</a></li>\n                        <div class="divider"></div>\n                        <li ng-click="setMode(\'auto-last1m\')"><a><i class="fa fa-fw"></i> Last month</a></li>\n                        <li ng-click="setMode(\'auto-last3m\')"><a><i class="fa fa-fw"></i> Last 3 months</a></li>\n                        <li ng-click="setMode(\'auto-last6m\')"><a><i class="fa fa-fw"></i> Last 6 months</a></li>\n                        <li ng-click="setMode(\'auto-last12m\')"><a><i class="fa fa-fw"></i> Last year</a></li>\n                        <li ng-click="setMode(\'auto-last24m\')"><a><i class="fa fa-fw"></i> Last 2 years</a></li>\n                        <li ng-click="setMode(\'auto-january1st\')"><a><i class="fa fa-fw"></i> From January 1st</a></li>\n                        <li ng-click="setMode(\'auto-yesterday\')"><a><i class="fa fa-fw"></i> Yesterday</a></li>\n                      </ul>\n                  </div>\n                 </div>\n\n            <div ng-show="datefilter.mode == \'custom\'" style="display: inline-block; margin: 0px;">\n\n                 &rArr;\n\n                 <div class="form-group" style="display: inline-block; margin: 0px;">\n                    <p class="input-group disabled" style="margin: 0px; display: inline-block;">\n                      <input ng-disabled="view.getControlsHidden()" autocomplete="off" type="text" style="height: 20px; width: 80px; display: inline-block;" class="form-control input-sm" uib-datepicker-popup="yyyy-MM-dd" ng-model="dateStart.value" is-open="dateStart.opened" datepicker-options="dateStart.options" ng-required="true" close-text="Close" />\n                      <span ng-hide="view.getControlsHidden()"  class="input-group-btn" style="display: inline-block;">\n                        <button type="button" style="height: 20px;" class="btn btn-default" ng-click="dateStartOpen()"><i class="fa fa-fw fa-calendar"></i></button>\n                      </span>\n                    </p>\n                </div>\n\n                <span ng-hide="view.getControlsHidden()" style="margin-left: 17px; margin-right: 0px;">-</span>\n                <span ng-show="view.getControlsHidden()" style="margin-left: 0px; margin-right: 0px;">-</span>\n\n                 <div class="form-group" style="display: inline-block; margin: 0px;">\n                    <p class="input-group" style="margin: 0px; display: inline-block;">\n                      <input ng-disabled="view.getControlsHidden()" autocomplete="off" type="text" style="height: 20px; width: 80px; display: inline-block;" class="form-control input-sm" uib-datepicker-popup="yyyy-MM-dd" ng-model="dateEnd.value" is-open="dateEnd.opened" datepicker-options="dateEnd.options" ng-required="true" close-text="Close" />\n                      <span ng-hide="view.getControlsHidden()" class="input-group-btn" style="display: inline-block;">\n                        <button type="button" style="height: 20px;" class="btn btn-default" ng-click="dateEndOpen()"><i class="fa fa-fw fa-calendar"></i></button>\n                      </span>\n                    </p>\n                </div>\n\n            </div>\n\n        </form>\n\n        </div>\n\n        <button type="button" ng-hide="view.getControlsHidden()" ng-click="selectDateFilter(datefilter.dimension, false)" class="btn btn-danger btn-xs" style="margin-left: 20px;"><i class="fa fa-fw fa-trash"></i></button>\n        <button type="button" class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px;"><i class="fa fa-fw fa-info"></i></button>\n\n\n    </div>\n</div>\n\n'),a.put("views/cube/filter/dimension.html",'<div ng-controller="CubesViewerViewsCubeFilterDimensionController">\n\n    <div class="panel panel-default panel-outline hidden-print" ng-hide="view.getControlsHidden()" style="border-color: #ffcccc;">\n        <div class="panel-heading clearfix" style="border-color: #ffcccc;">\n            <button class="btn btn-xs btn-danger pull-right" ng-click="closeDimensionFilter()"><i class="fa fa-fw fa-close"></i></button>\n            <h4 style="margin: 2px 0px 0px 0px;"><i class="fa fa-fw fa-filter"></i> Dimension filter: <b>{{ parts.label }}</b></h4>\n        </div>\n        <div class="panel-body">\n\n            <div >\n            <form >\n\n              <div class="form-group has-feedback" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px;">\n                <!-- <label for="search">Search:</label>  -->\n                <input type="text" class="form-control" ng-model="searchString" ng-model-options="{ debounce: 300 }" placeholder="Search..." style="width: 16em;">\n                <i class="fa fa-fw fa-times-circle form-control-feedback" ng-click="searchString = \'\'" style="cursor: pointer; pointer-events: inherit;"></i>\n              </div>\n\n              <div class="btn-group" style="margin-left: 10px; display: inline-block; vertical-align: middle; margin-bottom: 2px; margin-right: 5px;">\n                    <button class="btn btn-default" ng-click="selectAll();" type="button" title="Select all"><i class="fa fa-fw fa-check-square-o"></i></button>\n                    <button class="btn btn-default" ng-click="selectNone();" type="button" title="Select none"><i class="fa fa-fw fa-square-o"></i></button>\n              </div>\n\n<!--               <div class="form-group" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px;"> -->\n              <div class="btn-group" style="display: inline-block; vertical-align: middle; margin-bottom: 2px; margin-right: 5px;">\n                    <button ng-hide="parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionMinus"  class="btn btn-default" ng-click="showDimensionFilter(parts.drilldownDimensionMinus)" type="button" title="Drilldown less"><i class="fa fa-fw fa-minus"></i></button>\n                    <button ng-hide="parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionPlus"  class="btn btn-default" ng-click="showDimensionFilter(parts.drilldownDimensionPlus)" type="button" title="Drilldown more"><i class="fa fa-fw fa-plus"></i></button>\n                    <button class="btn btn-default" type="button" title="Drilldown this" ng-click="selectDrill(parts.drilldownDimension, true)"><i class="fa fa-fw fa-arrow-down"></i></button>\n              </div>\n\n              <div class="form-group" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px; margin-right: 5px;">\n                 <div class="btn btn-default" ng-click="filterShowAll = ! filterShowAll" ng-class="{ \'active\': filterShowAll, \'btn-info\': filterShowAll }">\n                    <i class="fa fa-fw fa-filter fa-rotate-180"></i> Show all\n                 </div>\n              </div>\n\n              <div class="form-group" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px; ">\n\n                  <div class="btn btn-default" ng-click="filterInverted = !filterInverted" ng-class="{ \'active\': filterInverted, \'btn-danger\': filterInverted }">\n                    <input type="checkbox" ng-model="filterInverted" style="pointer-events: none; margin: 0px; vertical-align: middle;" ></input>\n                    <b>&ne;</b> Invert\n                  </div>\n\n              </div>\n\n                <div class="form-group" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px;">\n                 <button ng-click="applyFilter()" class="btn btn-success" type="button"><i class="fa fa-fw fa-filter"></i> Apply</button>\n              </div>\n            </form>\n            </div>\n\n            <div class="clearfix"></div>\n\n            <div class="row">\n                <div class="col-xs-9 col-sm-6">\n                <div style="margin-top: 5px;">\n                    <div class="panel panel-default panel-outline" style="margin-bottom: 0px; "><div class="panel-body" style="max-height: 180px; overflow-y: auto; overflow-x: hidden;">\n                        <div ng-show="loadingDimensionValues" ><i class="fa fa-circle-o-notch fa-spin fa-fw"></i> Loading...</div>\n\n                        <div ng-if="!loadingDimensionValues">\n                            <div ng-repeat="val in dimensionValues | filter:filterDimensionValue(searchString)" style="overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap;">\n                                <label style="font-weight: normal; margin-bottom: 2px;">\n                                    <input type="checkbox" name="selectedValues[]" ng-model="val.selected" value="{{ ::val.value }}" style="vertical-align: bottom;" />\n                                    <span title="{{ val.label }}">{{ ::val.label }}</span>\n                                </label>\n                            </div>\n                        </div>\n\n                    </div></div>\n\n                    <div ng-if="!loadingDimensionValues" class="" style="margin-bottom: 0px; ">\n                        <div class="text-right">\n                            {{ dimensionValues.length }} items\n                        </div>\n                    </div>\n\n                    <div ng-if="!loadingDimensionValues && dimensionValues.length >= cubesService.cubesserver.info.json_record_limit" class="alert alert-warning" style="margin-bottom: 0px;">\n                        <div style="display: inline-block;"><i class="fa fa-exclamation"></i></div>\n                        <div style="display: inline-block; margin-left: 20px;">\n                            Limit of {{ cubesService.cubesserver.info.json_record_limit }} items has been hit. Dimension value list is <b>incomplete</b>.<br />\n                        </div>\n                    </div>\n\n                </div>\n                </div>\n            </div>\n\n            <div class="clearfix"></div>\n\n        </div>\n      </div>\n\n\n</div>\n'),a.put("views/cube/series/series.html",'<div ng-controller="CubesViewerViewsCubeSeriesController">\n\n    <!-- ($(view.container).find(\'.cv-view-viewdata\').children().size() == 0)  -->\n    <h3><i class="fa fa-fw fa-clock-o"></i> Series table\n        <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n    </h3>\n\n    <div ng-if="view.pendingRequests > 0" class="loadingbar-content">\n        <span class="loadingbar-expand"></span>\n    </div>\n\n    <div ng-if="view.grid.data.length > 0"\n         ui-grid="view.grid"\n         ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize\n         ui-grid-pagination ui-grid-pinning\n         style="width: 100%;" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 30 + \'px\'}">\n    </div>\n    <div ng-if="view.grid.data.length > 0" style="height: 30px;">&nbsp;</div>\n\n    <div ng-if="view.pendingRequests == 0 && view.params.yaxis == null" class="alert alert-info" style="margin-bottom: 0px;">\n        <p>\n            Cannot present series table: no <b>measure</b> has been selected.\n        </p>\n        <p>\n            Tip: use the <kbd><i class="fa fa-fw fa-cogs"></i> View &gt; <i class="fa fa-fw fa-crosshairs"></i> Measure</kbd> menu.\n        </p>\n    </div>\n\n    <div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.grid.data.length == 0" class="alert alert-info" style="margin-bottom: 0px;">\n        <p>\n            Cannot present series table: <b>no rows</b> are returned by the current horizontal dimension, drilldown or filtering combination.\n        </p>\n        <p>\n            Tip: use the <kbd><i class="fa fa-fw fa-cogs"></i> View</kbd> menu to select an horizontal dimension.\n        </p>\n    </div>\n\n</div>\n')}]);